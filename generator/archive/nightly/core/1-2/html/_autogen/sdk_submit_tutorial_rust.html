

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Client: Building and Submitting Transactions &mdash; Sawtooth latest documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Rust SDK API Reference" href="../sdk_rust.html" />
    <link rel="prev" title="Transaction Processor: Creating a Transaction Handler" href="sdk_TP_tutorial_rust.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../contents.html" class="icon icon-home" alt="Documentation Home"> Sawtooth
          

          
          </a>

          
            
            
              <div class="version">
                latest
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../app_developers_guide.html">Application Developer’s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../app_developers_guide/overview.html">Transaction Family Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../app_developers_guide/installing_sawtooth.html">Setting Up a Sawtooth Node for Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../app_developers_guide/creating_sawtooth_network.html">Creating a Sawtooth Test Network</a></li>
<li class="toctree-l2"><a class="reference internal" href="../app_developers_guide/intro_xo_transaction_family.html">Playing with the XO Transaction Family</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../app_developers_guide/using_the_sdks.html">Using the Sawtooth SDKs</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../app_developers_guide/sdk_table.html">Summary of Available SDKs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../app_developers_guide/go_sdk.html">Using the Go SDK</a></li>
<li class="toctree-l3"><a class="reference external" href="https://sawtooth.hyperledger.org/docs/sdk-java/nightly/master/">Using the Java SDK: sawtooth-java-sdk documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../app_developers_guide/javascript_sdk.html">Using the JavaScript SDK</a></li>
<li class="toctree-l3"><a class="reference internal" href="../app_developers_guide/python_sdk.html">Using the Python SDK</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../app_developers_guide/rust_sdk.html">Using the Rust SDK</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="sdk_overview_tutorial_rust.html">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="../app_developers_guide/sdk_prerequisites.html">Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="../app_developers_guide/rust_sdk_import.html">Importing the Rust SDK</a></li>
<li class="toctree-l4"><a class="reference internal" href="sdk_TP_tutorial_rust.html">Transaction Processor: Creating a Transaction Handler</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Client: Building and Submitting Transactions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../sdk_rust.html">Rust SDK API Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference external" href="https://sawtooth.hyperledger.org/docs/sdk-swift/nightly/master/">Using the Swift SDK: sawtooth-swift-sdk documentation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../app_developers_guide/no_sdk.html">Development Without an SDK</a></li>
<li class="toctree-l2"><a class="reference internal" href="../app_developers_guide/address_and_namespace.html">Address and Namespace Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../app_developers_guide/namespace_restriction.html">Namespace Restriction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../app_developers_guide/event_subscriptions.html">Subscribing to Events</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../architecture.html">Architecture Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../transaction_family_specifications.html">Transaction Family Specifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sysadmin_guide.html">System Administrator’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_references.html">SDK and API References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli.html">CLI Command Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community.html">Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../contents.html">Sawtooth</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../contents.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../app_developers_guide.html">Application Developer’s Guide</a> &raquo;</li>
        
          <li><a href="../app_developers_guide/using_the_sdks.html">Using the Sawtooth SDKs</a> &raquo;</li>
        
          <li><a href="../app_developers_guide/rust_sdk.html">Using the Rust SDK</a> &raquo;</li>
        
      <li>Client: Building and Submitting Transactions</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/_autogen/sdk_submit_tutorial_rust.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="client-building-and-submitting-transactions">
<h1>Client: Building and Submitting Transactions<a class="headerlink" href="#client-building-and-submitting-transactions" title="Permalink to this headline">¶</a></h1>
<p>The process of encoding information to be submitted to a distributed ledger is
generally non-trivial. A series of cryptographic safeguards are used to
confirm identity and data validity. Hyperledger Sawtooth is no different, but
the Rust SDK does provide client functionality that abstracts away
most of these details, and greatly simplifies the process of making changes to
the blockchain.</p>
<div class="section" id="creating-a-private-key-and-signer">
<h2>Creating a Private Key and Signer<a class="headerlink" href="#creating-a-private-key-and-signer" title="Permalink to this headline">¶</a></h2>
<p>In order to confirm your identity and sign the information you send to the
validator, you will need a 256-bit key. Sawtooth uses the secp256k1 ECDSA
standard for signing, which means that almost any set of 32 bytes is a valid
key. It is fairly simple to generate a valid key using the SDK’s <em>signing</em>
module.</p>
<p>A <em>Signer</em> wraps a private key and provides some convenient methods for signing
bytes and getting the private key’s associated public key.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="k">use</span><span class="w"> </span><span class="n">sawtooth_sdk</span>::<span class="n">signing</span>::<span class="n">CryptoFactory</span><span class="p">;</span><span class="w"></span>
<span class="k">use</span><span class="w"> </span><span class="n">sawtooth_sdk</span>::<span class="n">signing</span>::<span class="n">create_context</span><span class="p">;</span><span class="w"></span>

<span class="kd">let</span><span class="w"> </span><span class="n">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_context</span><span class="p">(</span><span class="s">&quot;secp256k1&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;Error creating the right context&quot;</span><span class="p">);</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">private_key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="n">new_random_private_key</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;Error generating a new Private Key&quot;</span><span class="p">);</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">crypto_factory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CryptoFactory</span>::<span class="n">new</span><span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="n">as_ref</span><span class="p">());</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">signer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">crypto_factory</span><span class="p">.</span><span class="n">new_signer</span><span class="p">(</span><span class="n">private_key</span><span class="p">.</span><span class="n">as_ref</span><span class="p">());</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This key is the <strong>only</strong> way to prove your identity on the blockchain. Any
person possessing it will be able to sign Transactions using your identity,
and there is no way to recover it if lost. It is very important that any
private key is kept secret and secure.</p>
</div>
</div>
<div class="section" id="encoding-your-payload">
<h2>Encoding Your Payload<a class="headerlink" href="#encoding-your-payload" title="Permalink to this headline">¶</a></h2>
<p>Transaction payloads are composed of binary-encoded data that is opaque to the
validator. The logic for encoding and decoding them rests entirely within the
particular Transaction Processor itself. As a result, there are many possible
formats, and you will have to look to the definition of the Transaction
Processor itself for that information. As an example, the <em>IntegerKey</em>
Transaction Processor uses a payload of three key/value pairs encoded as
<a class="reference external" href="https://en.wikipedia.org/wiki/CBOR">CBOR</a>. Creating one might look like this:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="k">extern</span><span class="w"> </span><span class="k">crate</span><span class="w"> </span><span class="n">serde</span><span class="p">;</span><span class="w"></span>
<span class="k">extern</span><span class="w"> </span><span class="k">crate</span><span class="w"> </span><span class="n">serde_cbor</span><span class="p">;</span><span class="w"></span>

<span class="k">use</span><span class="w"> </span><span class="n">serde</span>::<span class="p">{</span><span class="n">Serialize</span><span class="p">,</span><span class="w"> </span><span class="n">Deserialize</span><span class="p">};</span><span class="w"></span>

<span class="c1">// Using serde to create a serializable struct</span>
<span class="cp">#[derive(Debug, Serialize, Deserialize)]</span><span class="w"></span>
<span class="cp">#[serde(rename_all = </span><span class="s">&quot;PascalCase&quot;</span><span class="cp">)]</span><span class="w"></span>
<span class="k">struct</span> <span class="nc">Payload</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">verb</span>: <span class="nb">String</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">name</span>: <span class="nb">String</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">value</span>: <span class="kt">u32</span><span class="p">,</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// --snip--</span>
<span class="kd">let</span><span class="w"> </span><span class="n">payload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Payload</span><span class="p">{</span><span class="w">  </span><span class="n">verb</span><span class="w"> </span>: <span class="nb">String</span>::<span class="n">from</span><span class="p">(</span><span class="s">&quot;set&quot;</span><span class="p">),</span><span class="w"></span>
<span class="w">                        </span><span class="n">name</span><span class="w"> </span>: <span class="nb">String</span>::<span class="n">from</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">),</span><span class="w"></span>
<span class="w">                        </span><span class="n">value</span><span class="w"> </span>: <span class="mi">42</span><span class="w"> </span><span class="p">};</span><span class="w"></span>

<span class="kd">let</span><span class="w"> </span><span class="n">payload_bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">serde_cbor</span>::<span class="n">to_vec</span><span class="p">(</span><span class="o">&amp;</span><span class="n">payload</span><span class="p">).</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;upsi&quot;</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="building-the-transaction">
<h2>Building the Transaction<a class="headerlink" href="#building-the-transaction" title="Permalink to this headline">¶</a></h2>
<p><em>Transactions</em> are the basis for individual changes of state to the Sawtooth
blockchain. They are composed of a binary payload, a binary-encoded
<em>TransactionHeader</em> with some cryptographic safeguards and metadata about how
it should be handled, and a signature of that header. It would be worthwhile
to familiarize yourself with the information in
<a class="reference internal" href="../architecture/transactions_and_batches.html"><span class="doc">Transactions and Batches</span></a>, particularly the definition of
TransactionHeaders.</p>
<div class="section" id="create-the-transaction-header">
<h3>1. Create the Transaction Header<a class="headerlink" href="#create-the-transaction-header" title="Permalink to this headline">¶</a></h3>
<p>A TransactionHeader contains information for routing a transaction to the
correct transaction processor, what input and output state addresses are
involved, references to prior transactions it depends on, and the public keys
associated with the its signature. The header references the payload through a
SHA-512 hash of the payload bytes.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="k">extern</span><span class="w"> </span><span class="k">crate</span><span class="w"> </span><span class="n">protobuf</span><span class="p">;</span><span class="w"></span>
<span class="k">extern</span><span class="w"> </span><span class="k">crate</span><span class="w"> </span><span class="n">openssl</span><span class="p">;</span><span class="w"></span>
<span class="k">extern</span><span class="w"> </span><span class="k">crate</span><span class="w"> </span><span class="n">rand</span><span class="p">;</span><span class="w"></span>

<span class="k">use</span><span class="w"> </span><span class="n">rand</span>::<span class="p">{</span><span class="n">thread_rng</span><span class="p">,</span><span class="w"> </span><span class="n">Rng</span><span class="p">};</span><span class="w"></span>

<span class="k">use</span><span class="w"> </span><span class="n">protobuf</span>::<span class="n">Message</span><span class="w"></span>
<span class="k">use</span><span class="w"> </span><span class="n">protobuf</span>::<span class="n">RepeatedField</span><span class="p">;</span><span class="w"></span>

<span class="k">use</span><span class="w"> </span><span class="n">openssl</span>::<span class="n">sha</span>::<span class="n">sha512</span><span class="p">;</span><span class="w"></span>
<span class="k">use</span><span class="w"> </span><span class="n">sawtooth_sdk</span>::<span class="n">messages</span>::<span class="n">transaction</span>::<span class="n">TransactionHeader</span><span class="p">;</span><span class="w"></span>

<span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">txn_header</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TransactionHeader</span>::<span class="n">new</span><span class="p">();</span><span class="w"></span>
<span class="n">txn_header</span><span class="p">.</span><span class="n">set_family_name</span><span class="p">(</span><span class="nb">String</span>::<span class="n">from</span><span class="p">(</span><span class="s">&quot;intkey&quot;</span><span class="p">));</span><span class="w"></span>
<span class="n">txn_header</span><span class="p">.</span><span class="n">set_family_version</span><span class="p">(</span><span class="nb">String</span>::<span class="n">from</span><span class="p">(</span><span class="s">&quot;1.0&quot;</span><span class="p">));</span><span class="w"></span>

<span class="c1">// Generate a random 128 bit number to use as a nonce</span>
<span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">nonce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="k">u8</span><span class="p">;</span><span class="w"> </span><span class="mi">16</span><span class="p">];</span><span class="w"></span>
<span class="n">thread_rng</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="n">try_fill</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">nonce</span><span class="p">[</span><span class="o">..</span><span class="p">])</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;Error generating random nonce&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">txn_header</span><span class="p">.</span><span class="n">set_nonce</span><span class="p">(</span><span class="n">to_hex_string</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nonce</span><span class="p">.</span><span class="n">to_vec</span><span class="p">()));</span><span class="w"></span>

<span class="kd">let</span><span class="w"> </span><span class="n">input_vec</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vec</span><span class="o">!</span><span class="p">[</span><span class="nb">String</span>::<span class="n">from</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="s">&quot;1cf1266e282c41be5e4254d8820772c5518a2c5a8c0c7f7eda19594a7eb539453e1ed7&quot;</span><span class="p">,</span><span class="w"></span>
<span class="p">)];</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">output_vec</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vec</span><span class="o">!</span><span class="p">[</span><span class="nb">String</span>::<span class="n">from</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="s">&quot;1cf1266e282c41be5e4254d8820772c5518a2c5a8c0c7f7eda19594a7eb539453e1ed7&quot;</span><span class="p">,</span><span class="w"></span>
<span class="p">)];</span><span class="w"></span>

<span class="n">txn_header</span><span class="p">.</span><span class="n">set_inputs</span><span class="p">(</span><span class="n">RepeatedField</span>::<span class="n">from_vec</span><span class="p">(</span><span class="n">input_vec</span><span class="p">));</span><span class="w"></span>
<span class="n">txn_header</span><span class="p">.</span><span class="n">set_outputs</span><span class="p">(</span><span class="n">RepeatedField</span>::<span class="n">from_vec</span><span class="p">(</span><span class="n">output_vec</span><span class="p">));</span><span class="w"></span>
<span class="n">txn_header</span><span class="p">.</span><span class="n">set_signer_public_key</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="n">signer</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">get_public_key</span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;Error retrieving Public Key&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">as_hex</span><span class="p">(),</span><span class="w"></span>
<span class="p">);</span><span class="w"></span>
<span class="n">txn_header</span><span class="p">.</span><span class="n">set_batcher_public_key</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="n">signer</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">get_public_key</span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;Error retrieving Public Key&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">as_hex</span><span class="p">(),</span><span class="w"></span>
<span class="p">);</span><span class="w"></span>

<span class="n">txn_header</span><span class="p">.</span><span class="n">set_payload_sha512</span><span class="p">(</span><span class="n">to_hex_string</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sha512</span><span class="p">(</span><span class="o">&amp;</span><span class="n">payload_bytes</span><span class="p">).</span><span class="n">to_vec</span><span class="p">()));</span><span class="w"></span>

<span class="kd">let</span><span class="w"> </span><span class="n">txn_header_bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">txn_header</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="n">write_to_bytes</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;Error converting transaction header to bytes&quot;</span><span class="p">);</span><span class="w"></span>

<span class="c1">// --snip--</span>

<span class="c1">// To properly format the Sha512 String</span>
<span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">to_hex_string</span><span class="p">(</span><span class="n">bytes</span>: <span class="kp">&amp;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">String</span> <span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">strs</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bytes</span><span class="p">.</span><span class="n">iter</span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="o">|</span><span class="n">b</span><span class="o">|</span><span class="w"> </span><span class="n">format</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;{:02x}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">collect</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="n">strs</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Remember that a <em>batcher public_key</em> is the hex public key matching the private
key that will later be used to sign a Transaction’s Batch, and
<em>dependencies</em> are the <em>header signatures</em> of Transactions that must be
committed before this one (see <em>TransactionHeaders</em> in
<a class="reference internal" href="../architecture/transactions_and_batches.html"><span class="doc">Transactions and Batches</span></a>).</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <em>inputs</em> and <em>outputs</em> are the state addresses a Transaction is allowed
to read from or write to. With the Transaction above, we referenced the
specific address where the value of  <code class="docutils literal notranslate"><span class="pre">'foo'</span></code> is stored.  Whenever possible,
specific addresses should be used, as this will allow the validator to
schedule transaction processing more efficiently.</p>
<p>Note that the methods for assigning and validating addresses are entirely up
to the Transaction Processor. In the case of IntegerKey, there are <a class="reference external" href="../transaction_family_specifications/integerkey_transaction_family.html#addressing">specific
rules to generate valid addresses</a>, which must be followed or
Transactions will be rejected. You will need to follow the addressing rules
for whichever Transaction Family you are working with.</p>
</div>
</div>
<div class="section" id="create-the-transaction">
<h3>2. Create the Transaction<a class="headerlink" href="#create-the-transaction" title="Permalink to this headline">¶</a></h3>
<p>Once the TransactionHeader is constructed, its bytes are then used to create a
signature.  This header signature also acts as the ID of the transaction.  The
header bytes, the header signature, and the payload bytes are all used to
construct the complete Transaction.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="k">use</span><span class="w"> </span><span class="n">sawtooth_sdk</span>::<span class="n">messages</span>::<span class="n">transaction</span>::<span class="n">Transaction</span><span class="p">;</span><span class="w"></span>

<span class="kd">let</span><span class="w"> </span><span class="n">signature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">signer</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="n">sign</span><span class="p">(</span><span class="o">&amp;</span><span class="n">txn_header_bytes</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;Error signing the transaction header&quot;</span><span class="p">);</span><span class="w"></span>

<span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">txn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Transaction</span>::<span class="n">new</span><span class="p">();</span><span class="w"></span>
<span class="n">txn</span><span class="p">.</span><span class="n">set_header</span><span class="p">(</span><span class="n">txn_header_bytes</span><span class="p">.</span><span class="n">to_vec</span><span class="p">());</span><span class="w"></span>
<span class="n">txn</span><span class="p">.</span><span class="n">set_header_signature</span><span class="p">(</span><span class="n">signature</span><span class="p">);</span><span class="w"></span>
<span class="n">txn</span><span class="p">.</span><span class="n">set_payload</span><span class="p">(</span><span class="n">payload_bytes</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="optional-encode-the-transaction-s">
<h3>3. (optional) Encode the Transaction(s)<a class="headerlink" href="#optional-encode-the-transaction-s" title="Permalink to this headline">¶</a></h3>
<p>If the same machine is creating Transactions and Batches there is no need to
encode the Transaction instances. However, in the use case where Transactions
are being batched externally, they must be serialized before being transmitted
to the batcher. The Rust SDK offers two options for this. One or more
Transactions can be combined into a serialized <em>TransactionList</em> method, or can
be serialized as a single Transaction.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">txn_list_vec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vec</span><span class="o">!</span><span class="p">[</span><span class="n">txn1</span><span class="p">,</span><span class="w"> </span><span class="n">txn2</span><span class="p">];</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">txn_list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TransactionList</span>::<span class="n">new</span><span class="p">();</span><span class="w"></span>
<span class="n">txn_list</span><span class="p">.</span><span class="n">set_transactions</span><span class="p">(</span><span class="n">RepeatedField</span>::<span class="n">from_vec</span><span class="p">(</span><span class="n">txn_list_vec</span><span class="p">));</span><span class="w"></span>

<span class="kd">let</span><span class="w"> </span><span class="n">txn_list_bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">txn_list</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="n">write_to_bytes</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;Error converting Transaction List to bytes&quot;</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="building-the-batch">
<h2>Building the Batch<a class="headerlink" href="#building-the-batch" title="Permalink to this headline">¶</a></h2>
<p>Once you have one or more Transaction instances ready, they must be wrapped in a
<em>Batch</em>. Batches are the atomic unit of change in Sawtooth’s state. When a Batch
is submitted to a validator each Transaction in it will be applied (in order),
or <em>no</em> Transactions will be applied. Even if your Transactions are not
dependent on any others, they cannot be submitted directly to the validator.
They must all be wrapped in a Batch.</p>
<div class="section" id="create-the-batchheader">
<h3>1. Create the BatchHeader<a class="headerlink" href="#create-the-batchheader" title="Permalink to this headline">¶</a></h3>
<p>Similar to the TransactionHeader, there is a <em>BatchHeader</em> for each Batch.
As Batches are much simpler than Transactions, a BatchHeader needs only  the
public key of the signer and the list of Transaction IDs, in the same order they
are listed in the Batch.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="k">use</span><span class="w"> </span><span class="n">sawtooth_sdk</span>::<span class="n">messages</span>::<span class="n">batch</span>::<span class="n">BatchHeader</span><span class="p">;</span><span class="w"></span>

<span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">batch_header</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BatchHeader</span>::<span class="n">new</span><span class="p">();</span><span class="w"></span>

<span class="n">batch_header</span><span class="p">.</span><span class="n">set_signer_public_key</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="n">signer</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">get_public_key</span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;Error retrieving Public Key&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">as_hex</span><span class="p">(),</span><span class="w"></span>
<span class="p">);</span><span class="w"></span>

<span class="kd">let</span><span class="w"> </span><span class="n">transaction_ids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vec</span><span class="o">!</span><span class="p">[</span><span class="n">txn</span><span class="p">.</span><span class="n">clone</span><span class="p">()]</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="n">iter</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="o">|</span><span class="n">trans</span><span class="o">|</span><span class="w"> </span><span class="nb">String</span>::<span class="n">from</span><span class="p">(</span><span class="n">trans</span><span class="p">.</span><span class="n">get_header_signature</span><span class="p">()))</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="n">collect</span><span class="p">();</span><span class="w"></span>

<span class="n">batch_header</span><span class="p">.</span><span class="n">set_transaction_ids</span><span class="p">(</span><span class="n">RepeatedField</span>::<span class="n">from_vec</span><span class="p">(</span><span class="n">transaction_ids</span><span class="p">));</span><span class="w"></span>

<span class="kd">let</span><span class="w"> </span><span class="n">batch_header_bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">batch_header</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="n">write_to_bytes</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;Error converting batch header to bytes&quot;</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="create-the-batch">
<h3>2. Create the Batch<a class="headerlink" href="#create-the-batch" title="Permalink to this headline">¶</a></h3>
<p>Using the SDK, creating a Batch is similar to creating a transaction.  The
header is signed, and the resulting signature acts as the Batch’s ID.  The Batch
is then constructed out of the header bytes, the header signature, and the
transactions that make up the batch.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="k">use</span><span class="w"> </span><span class="n">sawtooth_sdk</span>::<span class="n">messages</span>::<span class="n">batch</span>::<span class="n">Batch</span><span class="p">;</span><span class="w"></span>

<span class="kd">let</span><span class="w"> </span><span class="n">signature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">signer</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="n">sign</span><span class="p">(</span><span class="o">&amp;</span><span class="n">batch_header_bytes</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;Error signing the batch header&quot;</span><span class="p">);</span><span class="w"></span>

<span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">batch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Batch</span>::<span class="n">new</span><span class="p">();</span><span class="w"></span>

<span class="n">batch</span><span class="p">.</span><span class="n">set_header</span><span class="p">(</span><span class="n">batch_header_bytes</span><span class="p">);</span><span class="w"></span>
<span class="n">batch</span><span class="p">.</span><span class="n">set_header_signature</span><span class="p">(</span><span class="n">signature</span><span class="p">);</span><span class="w"></span>
<span class="n">batch</span><span class="p">.</span><span class="n">set_transactions</span><span class="p">(</span><span class="n">RepeatedField</span>::<span class="n">from_vec</span><span class="p">(</span><span class="n">vec</span><span class="o">!</span><span class="p">[</span><span class="n">txn</span><span class="p">]));</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="encode-the-batch-es-in-a-batchlist">
<h3>3. Encode the Batch(es) in a BatchList<a class="headerlink" href="#encode-the-batch-es-in-a-batchlist" title="Permalink to this headline">¶</a></h3>
<p>In order to submit Batches to the validator, they  must be collected into a
<em>BatchList</em>.  Multiple batches can be submitted in one BatchList, though the
Batches themselves don’t necessarily need to depend on each other. Unlike
Batches, a BatchList is not atomic. Batches from other clients may be
interleaved with yours.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="k">use</span><span class="w"> </span><span class="n">sawtooth_sdk</span>::<span class="n">messages</span>::<span class="n">batch</span>::<span class="n">BatchList</span><span class="p">;</span><span class="w"></span>

<span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">batch_list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BatchList</span>::<span class="n">new</span><span class="p">();</span><span class="w"></span>
<span class="n">batch_list</span><span class="p">.</span><span class="n">set_batches</span><span class="p">(</span><span class="n">RepeatedField</span>::<span class="n">from_vec</span><span class="p">(</span><span class="n">vec</span><span class="o">!</span><span class="p">[</span><span class="n">batch</span><span class="p">]));</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">batch_list_bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">batch_list</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="n">write_to_bytes</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;Error converting batch list to bytes&quot;</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note, if the transaction creator is using a different private key than the
batcher, the <em>batcher public_key</em> must have been specified for every Transaction,
and must have been generated from the private key being used to sign the
Batch, or validation will fail.</p>
</div>
</div>
</div>
<div class="section" id="submitting-batches-to-the-validator">
<h2>Submitting Batches to the Validator<a class="headerlink" href="#submitting-batches-to-the-validator" title="Permalink to this headline">¶</a></h2>
<p>The prescribed way to submit Batches to the validator is via the REST API.
This is an independent process that runs alongside a validator, allowing clients
to communicate using HTTP/JSON standards. Simply send a <em>POST</em> request to the
<em>/batches</em> endpoint, with a <em>“Content-Type”</em> header of
<em>“application/octet-stream”</em>, and the <em>body</em> as a serialized <em>BatchList</em>.</p>
<p>There are a many ways to make an HTTP request, and hopefully the submission
process is fairly straightforward from here, but as an example, this is what it
might look if you sent the request from the same Rust process that
prepared the BatchList:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="c1">// When using an external crate don&#39;t forget to add it to your dependencies</span>
<span class="c1">// in the Cargo.toml file, just like with the sdk itself</span>
<span class="k">extern</span><span class="w"> </span><span class="k">crate</span><span class="w"> </span><span class="n">reqwest</span><span class="p">;</span><span class="w"></span>

<span class="kd">let</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reqwest</span>::<span class="n">Client</span>::<span class="n">new</span><span class="p">();</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">client</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">&quot;http://localhost:8008/batches&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="n">header</span><span class="p">(</span><span class="s">&quot;Content-Type&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;application/octet-stream&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="n">body</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="n">batch_list_bytes</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="n">send</span><span class="p">()</span><span class="w"></span>
</pre></div>
</div>
<p>And here is what it would look like if you saved the binary to a file, and then
sent it from the command line with <code class="docutils literal notranslate"><span class="pre">curl</span></code>:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">fs</span>::<span class="n">File</span><span class="p">;</span><span class="w"></span>
<span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">io</span>::<span class="n">Write</span><span class="p">;</span><span class="w"></span>

<span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span>::<span class="n">create</span><span class="p">(</span><span class="s">&quot;intkey.batches&quot;</span><span class="p">).</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;Error creating file&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">file</span><span class="p">.</span><span class="n">write_all</span><span class="p">(</span><span class="o">&amp;</span><span class="n">batch_list_bytes</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;Error writing bytes&quot;</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>% curl --request POST <span class="se">\</span>
    --header <span class="s2">&quot;Content-Type: application/octet-stream&quot;</span> <span class="se">\</span>
    --data-binary @intkey.batches <span class="se">\</span>
    <span class="s2">&quot;http://rest.api.domain/batches&quot;</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../sdk_rust.html" class="btn btn-neutral float-right" title="Rust SDK API Reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="sdk_TP_tutorial_rust.html" class="btn btn-neutral float-left" title="Transaction Processor: Creating a Transaction Handler" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2015-2017, Intel Corporation

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>