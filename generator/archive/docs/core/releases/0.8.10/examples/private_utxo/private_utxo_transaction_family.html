

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Private UTXO Transaction Family &mdash; Sawtooth v0.8.10 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="Sawtooth v0.8.10 documentation" href="../../index.html"/>
        <link rel="up" title="Private UTXO Example" href="overview.html"/>
        <link rel="next" title="Community" href="../../community.html"/>
        <link rel="prev" title="Private UTXO Example" href="overview.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../contents.html" class="icon icon-home"> Sawtooth
          

          
          </a>

          
            
            
              <div class="version">
                v0.8.10
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app_developers_guide.html">Application Developer&#8217;s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../solidity_developers_guide.html">Solidity Developers Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../core_developers_guide.html">Core Developer&#8217;s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sysadmin_guide.html">System Administrator&#8217;s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rest_api.html">REST API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cli.html">CLI Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../transaction_family_specifications.html">Transaction Family Specifications</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../examples.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../supplychain/overview.html">SupplyChain Example</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="overview.html">Private UTXO Example</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="overview.html#private-utxo-overview">Private UTXO Overview</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="overview.html#trading-and-transactions">Trading and Transactions</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="overview.html#private-utxo-transaction-family">Private UTXO Transaction Family</a></li>
<li class="toctree-l4"><a class="reference internal" href="overview.html#off-ledger-trading">Off-Ledger Trading</a></li>
<li class="toctree-l4"><a class="reference internal" href="overview.html#utee-enclave-operations">UTEE Enclave Operations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="overview.html#best-practices">Best Practices</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../community.html">Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq.html">FAQ</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../contents.html">Sawtooth</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../contents.html">Docs</a> &raquo;</li>
        
          <li><a href="../../examples.html">Examples</a> &raquo;</li>
        
          <li><a href="overview.html">Private UTXO Example</a> &raquo;</li>
        
      <li>Private UTXO Transaction Family</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/examples/private_utxo/private_utxo_transaction_family.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="private-utxo-transaction-family">
<h1>Private UTXO Transaction Family<a class="headerlink" href="#private-utxo-transaction-family" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This document describes a Transaction Family that allows for assets to be
tracked and traded on the Ledger as well as to be held off the Ledger. This
off-Ledger processing allows assets to be traded in a a  manner that enforces
the Ledger rules governing the Asset and allows transactional privacy for the
owner of the asset.</p>
<p>When assets are on-Ledger they are held in buckets associated with the owner’s
public key. In this state the balances and trades of and trades between
participants are visible to all who can see the Ledger. The second state of
assets is off-Ledger, as unspent transaction outputs (UTXO). In this form the
assets are represented as documents stored off-Ledger and the UTXO are opaque
identifiers of these documents stored in the Ledger. Trusted Execution
Environments(TEE) are used to validate and process off Ledger transactions.
Once validated by the TEE, the transaction is submitted to the Ledger recording
the UTXO consumed and the new UTXO produced.</p>
</div>
<div class="section" id="state">
<h2>State<a class="headerlink" href="#state" title="Permalink to this headline">¶</a></h2>
<p>This section describes in detail how Private UTXO Transaction Processor (PUTP)
objects are stored and addressed in the global state. All objects in state are
stored as encoded protobufs. The address of the Merkle nodes is detailed below
in the addressing section.</p>
<div class="section" id="assettype">
<h3>AssetType<a class="headerlink" href="#assettype" title="Permalink to this headline">¶</a></h3>
<p>AssetTypes represent types of assets being tracked and traded on the Ledger.</p>
<div class="highlight-protobuf"><div class="highlight"><pre><span></span><span class="c1">// AssetType State Representation</span>
<span class="kd">message</span> <span class="nc">AssetType</span> <span class="p">{</span>
    <span class="kt">string</span> <span class="na">name</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// the name of the asset type</span>
    <span class="kt">string</span> <span class="na">issuer</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">// the hex encoded public key of the issuer</span>
    <span class="kt">string</span> <span class="na">nonce</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="c1">// random vaue</span>
    <span class="kt">int64</span> <span class="na">amount</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span> <span class="c1">// Total amount of the asset issued.</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="holding">
<h3>Holding<a class="headerlink" href="#holding" title="Permalink to this headline">¶</a></h3>
<p>Holdings represent the amount of an assets a participant possesses on the
Ledger. This handles the unlikely case of collisions due to the transformation
of multiple public keys to the same address in global state.</p>
<p>The state entry for holdings is a container that allows the holdings of
multiple participants to be stored at the same address. This handles the
unlikely case of collisions due to the transformation of multiple public keys
to the same address in global state. The Holding container is a list of
participant holdings. Each holding is identified by the participant&#8217;s public
key.</p>
<p>The participant Holding is a list of key value pairs, with the key being the
AssetType address and the value being the amount of the asset the participant
has.</p>
<div class="highlight-protobuf"><div class="highlight"><pre><span></span><span class="p">}</span>

<span class="c1">// Participant holdings state representation</span>
<span class="kd">message</span> <span class="nc">Holdings</span> <span class="p">{</span>
    <span class="kt">string</span> <span class="na">identifier</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// the hex encoded public key of the participant</span>
    <span class="k">repeated</span> <span class="n">AssetHolding</span> <span class="na">asset_holdings</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">// unordered list of holdings.</span>
<span class="p">}</span>

<span class="c1">// Participant holdings container for storage in global state</span>
<span class="kd">message</span> <span class="nc">HoldingContainer</span> <span class="p">{</span>
    <span class="c1">// List of Participant entries - more than one implies a collision</span>
    <span class="c1">// when hashing agent public key to the Merkle Address</span>
    <span class="k">repeated</span> <span class="n">Holdings</span> <span class="na">entries</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="utxo">
<h3>UTXO<a class="headerlink" href="#utxo" title="Permalink to this headline">¶</a></h3>
<p>UTXO are stored in the state, The key uniquely identifies the UTXO. Since there
is no value associated with UTXO, the Key is stored as the value. The value and
details of the UTXO are described by the UtxoDocument held off chain.</p>
</div>
<div class="section" id="addressing">
<h3>Addressing<a class="headerlink" href="#addressing" title="Permalink to this headline">¶</a></h3>
<p>The PUTP uses the standard Sawtooth Merkle Addressing scheme a of 70 byte hex
encoded string, consisting of 6 characters of namespace and 64 characters of
key.</p>
<div class="section" id="asset-type-addresses">
<h4>Asset Type Addresses<a class="headerlink" href="#asset-type-addresses" title="Permalink to this headline">¶</a></h4>
<p>AssetTypes are stored in the address type namespace: &#8216;4251e9&#8217;, which is derived
by hex encoding the first 3 bytes of the sha512 hash of the string
&#8216;private_utxo.asset_types&#8217;.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">asset_namespace</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha512</span><span class="p">(</span><span class="s2">&quot;private_utxo.asset_types&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>\
<span class="gp">... </span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">asset_namespace</span>
<span class="go">&#39;4251e9&#39;</span>
</pre></div>
</div>
<p>AssetType addresses are derived from the contents of the create transaction.
The name, issuer&#8217;s hex encoded public key, and the nonce are concatenated and
the sha512 hash is taken. The result is hex encoded and the first 64 bytes of
the result are taken as the address.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">raw_key</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="n">issuer_public_key</span> <span class="o">+</span> <span class="n">nonce</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">address</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha512</span><span class="p">(</span><span class="n">raw_key</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="mi">64</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="holding-addresses">
<h4>Holding Addresses<a class="headerlink" href="#holding-addresses" title="Permalink to this headline">¶</a></h4>
<p>Holdings are stored in the address type namespace: &#8216;f1fc42&#8217;, which is derived
by hex encoding the first 3 bytes of the sha512 hash of the string
&#8216;private_utxo.holdings&#8217;.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">holdings_namespace</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha512</span><span class="p">(</span><span class="s2">&quot;private_utxo.holdings&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>\
<span class="gp">... </span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">holdings_namespace</span>
<span class="go">&#39;f1fc42&#39;</span>
</pre></div>
</div>
<p>Holding addresses are derived from the participant&#8217;s public key. The sha512
hash is taken of the participants hex encoded public key. The result is hex
encoded and the first 64 bytes of the result are taken as the address.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">address</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha512</span><span class="p">(</span><span class="n">public_key</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="mi">64</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="utxo-addresses">
<span id="id1"></span><h4>UTXO Addresses<a class="headerlink" href="#utxo-addresses" title="Permalink to this headline">¶</a></h4>
<p>UTXOs are stored in the address type namespace: &#8216;cbefaf&#8217;, which is derived by
hex encoding the first 3 bytes of the sha512 hash of the string
&#8216;private_utxo.utxo&#8217;.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">utxo_namespace</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha512</span><span class="p">(</span><span class="s2">&quot;private_utxo.utxo&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>\
<span class="gp">... </span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">utxo_namespace</span>
<span class="go">&#39;cbefaf&#39;</span>
</pre></div>
</div>
<p>UTXOs addresses are derived from the UtxoDocument. The sha512 hash is taken of
the UtxoDocument. The result is hex encoded and the first 64 bytes of the
result are taken as the address.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">address</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha512</span><span class="p">(</span><span class="n">utxo_document</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="mi">64</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="transactions">
<h2>Transactions<a class="headerlink" href="#transactions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="transaction-headers">
<h3>Transaction Headers<a class="headerlink" href="#transaction-headers" title="Permalink to this headline">¶</a></h3>
<p>The settings for the common Sawtooth Transaction header fields:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nx">family_name</span><span class="o">:</span> <span class="s2">&quot;sawtooth_private_utxo&quot;</span>
    <span class="nx">family_version</span><span class="o">:</span> <span class="s2">&quot;1.0&quot;</span>
    <span class="nx">encoding</span><span class="o">:</span> <span class="s2">&quot;application/protobuf&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="inputs-and-outputs">
<h3>Inputs and Outputs<a class="headerlink" href="#inputs-and-outputs" title="Permalink to this headline">¶</a></h3>
<div class="section" id="issue-asset">
<h4>Issue Asset<a class="headerlink" href="#issue-asset" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>Inputs:</p>
<ul class="simple">
<li>AssetType Address of the asset being issued</li>
</ul>
<p>Outputs:</p>
<ul class="simple">
<li>AssetType Address of the asset being issued</li>
<li>Holding Address of the transaction signer</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="transfer-asset">
<h4>Transfer Asset<a class="headerlink" href="#transfer-asset" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>Inputs:</p>
<ul class="simple">
<li>AssetType Address of the asset being transfered</li>
<li>Holding Address of the transaction signer</li>
<li>Holding Address of the recipient</li>
</ul>
<p>Outputs:</p>
<ul class="simple">
<li>Holding Address of the transaction signer</li>
<li>Holding Address of the recipient</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="convert-to-utxo">
<h4>Convert To UTXO<a class="headerlink" href="#convert-to-utxo" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>Inputs:</p>
<ul class="simple">
<li>AssetType Address of the asset being converted</li>
<li>Holding Address of the transaction signer</li>
</ul>
<p>Outputs:</p>
<ul class="simple">
<li>Holding Address of the transaction signer</li>
<li>The output UTXO address</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="convert-from-utxo">
<h4>Convert From UTXO<a class="headerlink" href="#convert-from-utxo" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>Inputs:</p>
<ul class="simple">
<li>AssetType Address of the asset being converted</li>
<li>Holding Address of the transaction signer</li>
<li>The UTXO address of the UtxoDocument</li>
</ul>
<p>Outputs:</p>
<ul class="simple">
<li>Holding Address of the transaction signer</li>
<li>The UTXO address of the UtxoDocument</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="transfer-utxo">
<h4>Transfer UTXO<a class="headerlink" href="#transfer-utxo" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>Inputs:</p>
<ul class="simple">
<li>Settings address for <cite>sawtooth.private_utxo.valid_enclave_measurements</cite></li>
<li>The all of the input and output UTXO addresses</li>
</ul>
<p>Outputs:</p>
<ul class="simple">
<li>The all of the input and output UTXO addresses</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="dependencies">
<h4>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h4>
<p>Transactions should be batched and should specify any transactions that they
expect to be committed to the ledger prior to execution as dependencies.</p>
</div>
</div>
</div>
<div class="section" id="transaction-payload">
<h2>Transaction Payload<a class="headerlink" href="#transaction-payload" title="Permalink to this headline">¶</a></h2>
<p>All Private UTXO transactions are wrapped in a payload object that allows for
the items to be dispatched to the correct handling logic.</p>
<div class="highlight-protobuf"><div class="highlight"><pre><span></span><span class="kd">message</span> <span class="nc">PrivateUtxoPayload</span> <span class="p">{</span>
    <span class="c1">// The action indicates data is contained within this payload</span>
    <span class="kd">enum</span> <span class="n">Action</span> <span class="p">{</span>
        <span class="na">ISSUE_ASSET</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="na">TRANSFER_ASSET</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="na">CONVERT_TO_UTXO</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="na">CONVERT_FROM_ASSET</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
        <span class="na">UTXO_TRANSFER</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// The action of this payload</span>
    <span class="n">Action</span> <span class="na">action</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="c1">// The content of this payload</span>
    <span class="kt">bytes</span> <span class="na">data</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Payload for Asset issuance</span>
</pre></div>
</div>
<div class="section" id="id2">
<h3>Issue Asset<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<div class="highlight-protobuf"><div class="highlight"><pre><span></span><span class="kd">message</span> <span class="nc">IssueAssetPayload</span> <span class="p">{</span>
    <span class="kt">string</span> <span class="na">name</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// The name of the asset</span>
    <span class="kt">int64</span> <span class="na">amount</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">// The amount of the asset to issue</span>
    <span class="kt">string</span> <span class="na">nonce</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="c1">// A random value to ensure AssetType uniqueness</span>
<span class="p">}</span>

<span class="c1">// Payload for transfering Assets</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h3>Transfer Asset<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<div class="highlight-protobuf"><div class="highlight"><pre><span></span><span class="kd">message</span> <span class="nc">TransferAssetPayload</span> <span class="p">{</span>
    <span class="kt">string</span> <span class="na">recipient</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// The public key of the recepient</span>
    <span class="kt">string</span> <span class="na">asset_type</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">// The address of the AssetType to transfer</span>
    <span class="kt">int64</span> <span class="na">amount</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="c1">// the amount to send to the recipient</span>
<span class="p">}</span>

<span class="c1">// Payload to converting on chain asset holdings to UTXO</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h3>Convert To UTXO<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<div class="highlight-protobuf"><div class="highlight"><pre><span></span><span class="kd">message</span> <span class="nc">ConvertToUtxoPayload</span> <span class="p">{</span>
    <span class="kt">string</span> <span class="na">asset_type</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// The address of the AssetType to transfer</span>
    <span class="kt">int64</span> <span class="na">amount</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">// The amount of the asset to to convert</span>
    <span class="kt">string</span> <span class="na">nonce</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>  <span class="c1">// A random value to ensure AssetType uniqueness</span>
    <span class="kt">string</span> <span class="na">output_utxo</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span> <span class="c1">// The UTXO address of the resulting UtxoDocument</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h3>Convert From UTXO<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<div class="highlight-protobuf"><div class="highlight"><pre><span></span><span class="kd">message</span> <span class="nc">ConvertFromUtxoPayload</span> <span class="p">{</span>
    <span class="kt">string</span> <span class="na">document</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// the UtxoDocument being converted</span>
<span class="p">}</span>

<span class="c1">// Transfer UTXO ownership off ledger</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h3>Transfer UTXO<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<div class="highlight-protobuf"><div class="highlight"><pre><span></span><span class="kd">message</span> <span class="nc">UtxoTransferPayload</span> <span class="p">{</span>
    <span class="k">repeated</span> <span class="kt">string</span> <span class="na">inputs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// the UTXO to be consumed</span>
    <span class="k">repeated</span> <span class="kt">string</span> <span class="na">outputs</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">// the UTXO to be produced</span>
    <span class="kt">string</span> <span class="na">attestation</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="c1">// the Attestation Verification Report signed by</span>
    <span class="c1">// IAS</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="execution">
<h2>Execution<a class="headerlink" href="#execution" title="Permalink to this headline">¶</a></h2>
<div class="section" id="holdings">
<h3>Holdings<a class="headerlink" href="#holdings" title="Permalink to this headline">¶</a></h3>
<p>Participant Holdings are created when written to. If a Participants holdings
are being read and the Holding for that participant does not exist, the
particpant&#8217;s holding of that asset are zero.</p>
</div>
<div class="section" id="id7">
<h3>Issue Asset<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p><strong>Issue Asset</strong> transactions create new assets for trading. This can either be
in the form of creating a new AssetType entry or adding to the amount of an
existing asset in circulation.</p>
<p><strong>Issue Asset</strong> transactions are validated as follows:</p>
<p>The address of the AssetType and the signer of the transaction are calculated.</p>
<p>If the AssetType exists and the AssetType issuer is the signer, then the
amount of the AssetType and the signers holdings for that AssetType are
increased by the transaction amount.</p>
<p>If the AssetType exists but the signer is not the issuer of the AssetType, the
transaction is invalid. These failures may be caused by collisions in the
AssetType address. If a transaction creates an AssetType that already exists
then it is an invalid transaction. In this case, the create AssetType
transactions should be recreated with a new nonce and resubmitted.</p>
<p>If the AssetType does not exist, then the AssetType is created with the Amount
from the transaction and the signers holdings for that AssetType are set to
the transaction amount.</p>
</div>
<div class="section" id="id8">
<h3>Transfer Asset<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p><strong>Transfer Asset</strong> transactions are used to move assets from one participant&#8217;s
holdings to another participant&#8217;s holdings.</p>
<p><strong>Transfer Asset</strong> transactions are validated as follows:</p>
<p>The signer of the transaction is calculated.</p>
<p>If the <cite>asset_type</cite> of the transaction does not exist, the transaction fails.
If the signer&#8217;s holdings of the asset type are less than the transaction
amount, the transaction fails.</p>
<p>If the above validation steps pass, then the transaction amount is removed from
the signers holdings and added to the transaction recipients holdings.</p>
</div>
<div class="section" id="id9">
<h3>Convert To UTXO<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p><strong>Convert To UTXO</strong> transactions are used to move assets from ledger holdings
to an off-Ledger UtxoDocument for private trading.</p>
<p><strong>Convert To UTXO</strong> transactions are validated as follows:</p>
<p>The signer of the transaction is calculated.</p>
<p>If the <cite>asset_type</cite> of the transaction does not exist, the transaction fails.</p>
<p>If the signer&#8217;s holdings of the <cite>asset_type</cite> are less than the transaction
amount the transaction fails.</p>
<p>The UtxoDocument is created with the signer as the document owner, and
the asset_type, amount, and nonce from the transaction. The UtxoDocument
address is computed and compared to the transactions output_utxo field. If
the addresses do not match, the transaction fails. UTXO collisions are not
allowed. If a transaction on UTXO creates a UTXO that already exists, it is an
invalid transaction. In this case the UtxoDocument should be recreated with a
new nonce and the transaction should be recreated.</p>
<p>If the above validation steps pass, then the transaction amount is removed from
the signer&#8217;s holdings and the transaction <cite>output_utxo</cite> address is added
to the UTXO store.</p>
</div>
<div class="section" id="id10">
<h3>Convert From UTXO<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p><strong>Convert From UTXO</strong> transactions are used to move off-Ledger assets held in
UtxoDocuments to on-Ledger holdings.</p>
<p><strong>Convert From UTXO</strong> transactions are validated as follows:</p>
<p>The signer of the transaction is calculated. The transaction document is
unpacked. The UtxoDocument address of the transaction document is calculated.</p>
<p>If the UtxoDocument address does not exist, the transaction fails.</p>
<p>If the <cite>asset_type</cite> of the document does not exist, the transaction fails. This
is done to ensure system consistency.</p>
<p>If the above validation steps pass, then the document amount is added to
the signer&#8217;s holdings and the UtxoDocument address is removed
from the UTXO store.</p>
</div>
<div class="section" id="id11">
<h3>Transfer UTXO<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p><strong>Transfer UTXO</strong> transactions to facilitate off-Ledger trading.</p>
<p><strong>Transfer UTXO</strong> transactions are validated as follows:</p>
<p>The transaction <cite>attestation</cite> is validated:</p>
<ul class="simple">
<li>If the attestation is not signed by IAS, the transaction fails</li>
<li>If the attestation&#8217;s <cite>mr_enclave</cite> is not the
<cite>sawtooth.private_utxo.valid_enclave_measurements</cite>, the transaction fails.</li>
<li>The attestation&#8217;s report data (<cite>sgx_report_data_t</cite>) does not match the
sha512(input|output), the transaction fails.</li>
</ul>
<p>All input UTXO in the transaction must exist in the UTXO Store or the
transaction fails.</p>
<p>UTXO collisions are not allowed. If any of the UTXO outputs exist, then the
transaction fails. In this case, the output UtxoDocument should be recreated
with a new nonce and the transaction should be recreated.</p>
<p>If the above validation steps pass, then the transaction inputs are removed
from the UTXO store and the transaction outputs are added to the UTXO store.</p>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../community.html" class="btn btn-neutral float-right" title="Community" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="overview.html" class="btn btn-neutral" title="Private UTXO Example" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015-2017, Intel Corporation.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'v0.8.10',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>