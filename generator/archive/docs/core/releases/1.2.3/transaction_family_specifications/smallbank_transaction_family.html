

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Smallbank Transaction Family &mdash; Sawtooth v1.2.3 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="System Administrator’s Guide" href="../sysadmin_guide.html" />
    <link rel="prev" title="PoET Validator Registry Transaction Family" href="validator_registry_transaction_family.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../contents.html" class="icon icon-home"> Sawtooth
          

          
          </a>

          
            
            
              <div class="version">
                v1.2.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../app_developers_guide.html">Application Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture.html">Architecture Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../transaction_family_specifications.html">Transaction Family Specifications</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="settings_transaction_family.html">Settings Transaction Family</a></li>
<li class="toctree-l2"><a class="reference internal" href="identity_transaction_family.html">Identity Transaction Family</a></li>
<li class="toctree-l2"><a class="reference internal" href="blockinfo_transaction_family.html">BlockInfo Transaction Family</a></li>
<li class="toctree-l2"><a class="reference internal" href="integerkey_transaction_family.html">IntegerKey Transaction Family</a></li>
<li class="toctree-l2"><a class="reference internal" href="xo_transaction_family.html">XO Transaction Family</a></li>
<li class="toctree-l2"><a class="reference internal" href="validator_registry_transaction_family.html">PoET Validator Registry Transaction Family</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Smallbank Transaction Family</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#state">State</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#addressing">Addressing</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#transaction-payload">Transaction Payload</a></li>
<li class="toctree-l3"><a class="reference internal" href="#transaction-header">Transaction Header</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#inputs-and-outputs">Inputs and Outputs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dependencies">Dependencies</a></li>
<li class="toctree-l4"><a class="reference internal" href="#family">Family</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#execution">Execution</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference external" href="https://sawtooth.hyperledger.org/docs/sabre/releases/v1.2.3/">Sawtooth Sabre Transaction Family</a></li>
<li class="toctree-l2"><a class="reference external" href="https://sawtooth.hyperledger.org/docs/seth/nightly/master/">Sawtooth Seth Transaction Family</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../sysadmin_guide.html">System Administrator’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_references.html">SDK and API References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli.html">CLI Command Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community.html">Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../contents.html">Sawtooth</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../contents.html">Docs</a> &raquo;</li>
        
          <li><a href="../transaction_family_specifications.html">Transaction Family Specifications</a> &raquo;</li>
        
      <li>Smallbank Transaction Family</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/transaction_family_specifications/smallbank_transaction_family.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="smallbank-transaction-family">
<h1>Smallbank Transaction Family<a class="headerlink" href="#smallbank-transaction-family" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>The Smallbank transaction family is based on the H-Store Smallbank
benchmark originally published as part of the H-Store database benchmarking
project.</p>
<blockquote>
<div><p><a class="reference external" href="http://hstore.cs.brown.edu/documentation/deployment/benchmarks/smallbank/">http://hstore.cs.brown.edu/documentation/deployment/benchmarks/smallbank/</a></p>
</div></blockquote>
<p>This transaction family is intended for use in benchmarking and performance
testing activities in the hopes of providing a somewhat cross-platform
workload for comparing the performance of blockchain systems.</p>
<p>The Smallbank Transaction Family consists of a single Account datatype, one
transaction which creates accounts and five transactions which modify account
values based on a set of rules. The H-Store benchmark included a sixth
transaction for reading balances which does not make sense in the context
of blockchain transactions.</p>
<p>Smallbank Transaction payloads consist of a serialized protobuf wrapper
containing the type and data payload of the sub transaction types.</p>
</div>
<div class="section" id="state">
<h2>State<a class="headerlink" href="#state" title="Permalink to this headline">¶</a></h2>
<p>This section describes in detail how Smallbank transaction information
is stored and addressed.</p>
<p>Smallbank Account values are stored in state as serialized protobufs
containing generated customer IDs, customer names, and savings and
checking balances. The ‘primary key’ of the data is the unique customer_id.</p>
<div class="highlight-protobuf notranslate"><div class="highlight"><pre><span></span><span class="kd">message</span> <span class="nc">Account</span> <span class="p">{</span>
    <span class="c1">// Customer ID</span>
    <span class="kt">uint32</span> <span class="na">customer_id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="c1">// Customer Name</span>
    <span class="kt">string</span> <span class="na">customer_name</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

    <span class="c1">// Savings Balance (in cents to avoid float)</span>
    <span class="kt">uint32</span> <span class="na">savings_balance</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

    <span class="c1">// Checking Balance (in cents to avoid float)</span>
    <span class="kt">uint32</span> <span class="na">checking_balance</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="addressing">
<h3>Addressing<a class="headerlink" href="#addressing" title="Permalink to this headline">¶</a></h3>
<p>Smallbank Account data is stored in state using addresses which are
generated from the Smallbank namespace prefix and the unique customer_id
of the Account entry. Addresses will adhere to the following format:</p>
<ul class="simple">
<li><p>Addresses must be a 70 character hexadecimal string</p></li>
<li><p>The first 6 characters of the address are the first 6 characters
of a sha512 hash of the Smallbank namespace prefix: “smallbank”</p></li>
<li><p>The following 64 characters of the address are the last 64 characters
of a sha512 hash of the value of customer_id</p></li>
</ul>
<p>For example, a Smallbank address could be generated as follows:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">customer_id</span> <span class="o">=</span> <span class="mi">42</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hashlib</span><span class="o">.</span><span class="n">sha512</span><span class="p">(</span><span class="s1">&#39;smallbank&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span> <span class="o">+</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha512</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">customer_id</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()[</span><span class="o">-</span><span class="mi">64</span><span class="p">:]</span>
<span class="go">&#39;3325143ff98ae73225156b2c6c9ceddbfc16f5453e8fa49fc10e5d96a3885546a46ef4&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="transaction-payload">
<h2>Transaction Payload<a class="headerlink" href="#transaction-payload" title="Permalink to this headline">¶</a></h2>
<p>Smallbank transaction request payloads are defined by the following
protobuf structure:</p>
<div class="highlight-protobuf notranslate"><div class="highlight"><pre><span></span><span class="kd">message</span> <span class="nc">SmallbankTransactionPayload</span> <span class="p">{</span>
    <span class="kd">enum</span> <span class="n">PayloadType</span> <span class="p">{</span>
        <span class="na">CREATE_ACCOUNT</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="na">DEPOSIT_CHECKING</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="na">WRITE_CHECK</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
        <span class="na">TRANSACT_SAVINGS</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
        <span class="na">SEND_PAYMENT</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
        <span class="na">AMALGAMATE</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">PayloadType</span> <span class="na">payload_type</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">CreateAccountTransactionData</span> <span class="na">create_account</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">DepositCheckingTransactionData</span> <span class="na">deposit_checking</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="n">WriteCheckTranasctionData</span> <span class="na">write_check</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
    <span class="n">TransactSavingsTransactionData</span> <span class="na">transact_savings</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
    <span class="n">SendPaymentTransactionData</span> <span class="na">send_payment</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
    <span class="n">AmalgamateTransactionData</span> <span class="na">amalgamate</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Based on the selected type, the data field will contain the appropriate
transaction data (these messages would be defined within
SmallbankTransactionPayload):</p>
<div class="highlight-protobuf notranslate"><div class="highlight"><pre><span></span><span class="kd">message</span> <span class="nc">CreateAccountTransactionData</span> <span class="p">{</span>
    <span class="c1">// The CreateAccountTransaction creates an account</span>

    <span class="c1">// Customer ID</span>
    <span class="kt">uint32</span> <span class="na">customer_id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="c1">// Customer Name</span>
    <span class="kt">string</span> <span class="na">customer_name</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

    <span class="c1">// Initial Savings Balance (in cents to avoid float)</span>
    <span class="kt">uint32</span> <span class="na">initial_savings_balance</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

    <span class="c1">// Initial Checking Balance (in cents to avoid float)</span>
    <span class="kt">uint32</span> <span class="na">initial_checking_balance</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">message</span> <span class="nc">DepositCheckingTransactionData</span> <span class="p">{</span>
    <span class="c1">// The DepositCheckingTransction adds an amount to the customer&#39;s</span>
    <span class="c1">// checking account.</span>

    <span class="c1">// Customer ID</span>
    <span class="kt">uint32</span> <span class="na">customer_id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="c1">// Amount</span>
    <span class="kt">uint32</span> <span class="na">amount</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">message</span> <span class="nc">WriteCheckTransactionData</span> <span class="p">{</span>
    <span class="c1">// The WriteCheckTransaction removes an amount from the customer&#39;s</span>
    <span class="c1">// checking account.</span>

    <span class="c1">// Customer ID</span>
    <span class="kt">uint32</span> <span class="na">customer_id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="c1">// Amount</span>
    <span class="kt">uint32</span> <span class="na">amount</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">message</span> <span class="nc">TransactSavingsTransactionData</span> <span class="p">{</span>
    <span class="c1">// The TransactSavingsTransaction adds an amount to the customer&#39;s</span>
    <span class="c1">// savings account. Amount may be a negative number.</span>

    <span class="c1">// Customer ID</span>
    <span class="kt">uint32</span> <span class="na">customer_id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="c1">// Amount</span>
    <span class="kt">int32</span> <span class="na">amount</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">message</span> <span class="nc">SendPaymentTransactionData</span> <span class="p">{</span>
    <span class="c1">// The SendPaymentTransaction transfers an amount from one customer&#39;s</span>
    <span class="c1">// checking account to another customer&#39;s checking account.</span>

    <span class="c1">// Source Customer ID</span>
    <span class="kt">uint32</span> <span class="na">source_customer_id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="c1">// Destination Customer ID</span>
    <span class="kt">uint32</span> <span class="na">dest_customer_id</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

    <span class="c1">// Amount</span>
    <span class="kt">uint32</span> <span class="na">amount</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">message</span> <span class="nc">AmalgamateTransactionData</span> <span class="p">{</span>
    <span class="c1">// The AmalgamateTransaction transfers the entire contents of one</span>
    <span class="c1">// customer&#39;s savings account into another customer&#39;s checking</span>
    <span class="c1">// account.</span>

    <span class="c1">// Source Customer ID</span>
    <span class="kt">uint32</span> <span class="na">source_customer_id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="c1">// Destination Customer ID</span>
    <span class="kt">uint32</span> <span class="na">dest_customer_id</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="transaction-header">
<h2>Transaction Header<a class="headerlink" href="#transaction-header" title="Permalink to this headline">¶</a></h2>
<div class="section" id="inputs-and-outputs">
<h3>Inputs and Outputs<a class="headerlink" href="#inputs-and-outputs" title="Permalink to this headline">¶</a></h3>
<p>The inputs for Smallbank family transactions must include:</p>
<ul class="simple">
<li><p>Address of the customer_id being accessed for CreateAccount,
DepositChecking, WriteCheck, and TransactSavings transactions, and
both the source and destination customer_ids being accessed for
SendPayment and Amalgamate transactions.</p></li>
</ul>
<p>The outputs for Smallbank family transactions must include:</p>
<ul class="simple">
<li><p>Address of the customer_id being modified for CreateAccount,
DepositChecking, WriteCheck, and TransactSavings transactions, and
both the source and destination customer_ids being modified for
SendPayment and Amalgamate transactions.</p></li>
</ul>
</div>
<div class="section" id="dependencies">
<h3>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>List of transaction <em>header_signatures</em> that are required dependencies
and must be processed prior to processing this transaction</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>While any CreateAccount transaction signatures should probably
be listed in any other modification transactions that reference those
accounts, it may be sufficient to submit a set of CreateAccount transactions,
ensure they are committed to the chain and then proceed without explicit
dependencies.</p>
</div>
</div>
<div class="section" id="family">
<h3>Family<a class="headerlink" href="#family" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>family_name: “smallbank”</p></li>
<li><p>family_version: “1.0”</p></li>
</ul>
</div>
</div>
<div class="section" id="execution">
<h2>Execution<a class="headerlink" href="#execution" title="Permalink to this headline">¶</a></h2>
<p>A CreateAccount transaction is only valid if:</p>
<ul class="simple">
<li><p>customer_id is specified</p></li>
<li><p>there is not already an existing account at the address associated with
that customer_id</p></li>
<li><p>customer_name is specified (not an empty string)</p></li>
<li><p>initial_savings_balance is specified</p></li>
<li><p>initial_checking_balance is specified</p></li>
</ul>
<p>The result of a successful CreateAccount transaction is that the new Account
object is set in state.</p>
<p>A DepositChecking transaction is only valid if:</p>
<ul class="simple">
<li><p>customer_id is specified</p></li>
<li><p>there is an account at the address associated with that customer_id</p></li>
<li><p>amount is specified</p></li>
<li><p>amount + Account.checking_balance doesn’t result in an overflow of uint32</p></li>
</ul>
<p>The result of a successful DepositChecking transaction is that the specified
Account.checking_balance = Account.checking_balance + amount.</p>
<p>A WriteCheck transaction is only valid if:</p>
<ul class="simple">
<li><p>customer_id is specified</p></li>
<li><p>there is an account at the address associated with that customer_id</p></li>
<li><p>amount is specified</p></li>
<li><p>Account.checking_balance - amount doesn’t result in a value &lt; 0</p></li>
</ul>
<p>The result of a successful WriteCheck transaction is that the specified
Account’s checking balance is decremented by amount.</p>
<p>A TransactSavings transaction is only valid if:</p>
<ul class="simple">
<li><p>customer_id is specified</p></li>
<li><p>there is an account at the address associated with that customer_id</p></li>
<li><p>amount is specified</p></li>
<li><p>Account.savings_balance + amount doesn’t result in a value &lt; 0 or a value
which overflows uint32</p></li>
</ul>
<p>The result of a successful TransactSavings transaction is that the
specified Account’s savings balance is modified by the addition of amount
(which may be negative).</p>
<p>A SendPayment transaction is only valid if:</p>
<ul class="simple">
<li><p>both source_customer_id and dest_customer_id are specified</p></li>
<li><p>there is an account at both locations</p></li>
<li><p>source.checking_balance - amount doesn’t result in a value &lt; 0</p></li>
<li><p>dest.checking_balance + amount doesn’t result in a value which overflows
uint32</p></li>
</ul>
<p>The result of a successful SendPayment transaction is that the source’s
checking balance is decremented by amount and the destination’s checking
balance is incremented by amount.</p>
<p>An Amalgamate transaction is only valid if:</p>
<ul class="simple">
<li><p>both source_customer_id and dest_customer_id are specified</p></li>
<li><p>there is an account at both locations</p></li>
<li><p>source.savings_balance is &gt; 0</p></li>
<li><p>dest.checking_balance + source.savings_balance does not overflow uint32</p></li>
</ul>
<p>The result of a successful Amalgamate transaction is that the destination’s
checking balance is incremented by the value of the source’s savings balance
and that the source’s savings balance is set to zero.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../sysadmin_guide.html" class="btn btn-neutral float-right" title="System Administrator’s Guide" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="validator_registry_transaction_family.html" class="btn btn-neutral float-left" title="PoET Validator Registry Transaction Family" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015-2017, Intel Corporation

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>