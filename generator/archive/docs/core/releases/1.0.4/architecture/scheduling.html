

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Transaction Scheduling &mdash; Sawtooth v1.0.4 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="REST API" href="rest_api.html" />
    <link rel="prev" title="Journal" href="journal.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../contents.html" class="icon icon-home"> Sawtooth
          

          
          </a>

          
            
            
              <div class="version">
                v1.0.4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../architecture.html">Architecture Description</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="global_state.html">Global State</a></li>
<li class="toctree-l2"><a class="reference internal" href="transactions_and_batches.html">Transactions and Batches</a></li>
<li class="toctree-l2"><a class="reference internal" href="journal.html">Journal</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Transaction Scheduling</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#scheduling-within-the-validator">Scheduling within the Validator</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#chain-controller">Chain Controller</a></li>
<li class="toctree-l4"><a class="reference internal" href="#block-publisher">Block Publisher</a></li>
<li class="toctree-l4"><a class="reference internal" href="#executor">Executor</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#iterative-scheduling">Iterative Scheduling</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#serial-scheduler">Serial Scheduler</a></li>
<li class="toctree-l4"><a class="reference internal" href="#parallel-scheduler">Parallel Scheduler</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="rest_api.html">REST API</a></li>
<li class="toctree-l2"><a class="reference internal" href="poet.html">PoET 1.0 Specification</a></li>
<li class="toctree-l2"><a class="reference internal" href="validator_network.html">Validator Network</a></li>
<li class="toctree-l2"><a class="reference internal" href="permissioning_requirement.html">Permissioning Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="injecting_batches_block_validation_rules.html">Injecting Batches and On-Chain Block Validation Rules</a></li>
<li class="toctree-l2"><a class="reference internal" href="events_and_transactions_receipts.html">Events and Transaction Receipts</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../app_developers_guide.html">Application Developer&#8217;s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../transaction_family_specifications.html">Transaction Family Specifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sysadmin_guide.html">System Administrator&#8217;s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_references.html">API References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli.html">CLI Command Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community.html">Community</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../contents.html">Sawtooth</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../contents.html">Docs</a> &raquo;</li>
        
          <li><a href="../architecture.html">Architecture Description</a> &raquo;</li>
        
      <li>Transaction Scheduling</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/architecture/scheduling.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="transaction-scheduling">
<h1>Transaction Scheduling<a class="headerlink" href="#transaction-scheduling" title="Permalink to this headline">¶</a></h1>
<p>Sawtooth supports both serial and parallel scheduling of transactions. The
scheduler type is specified via a command line argument or as an option in the
validator&#8217;s configuration file when the validator process is started.  Both
schedulers result in the same deterministic results and are completely
interchangeable.</p>
<p>The parallel processing of transactions provides a performance improvement for
even fast transaction workloads by reducing overall latency effects which occur
when transaction execution is performed serially.  When transactions are of
non-uniform duration (such as may happen with more realistic complex
workloads), the performance benefit is especially magnified when faster
transactions outnumber slower transactions.</p>
<p>Transaction scheduling and execution in Sawtooth correctly and efficiently
handles transactions which modify the same state addresses, including
transactions within the same block.  Even at the batch level, transactions can
modify the same state addresses. Naive distributed ledger implementations may
not allow overlapping state modifications within a block, severely limiting
performance of such transactions to one-transaction-per-block, but Sawtooth has
no such block-level restriction. Instead, state is incremental per transaction
execution. This prevents double spends while allowing multiple transactions
which alter the same state values to appear in a single block. Of course, in
cases where these types of block-level restrictions are desired, transaction
families may implement the appropriate business logic.</p>
<div class="section" id="scheduling-within-the-validator">
<h2>Scheduling within the Validator<a class="headerlink" href="#scheduling-within-the-validator" title="Permalink to this headline">¶</a></h2>
<p>The sawtooth-validator process has two major components which use schedulers to
calculate state changes and the resulting Merkle hashes based on transaction
processing: the Chain Controller and the Block Publisher.  The Chain Controller
and Block Publisher pass a scheduler to the Executor. While the validator
contains only a single Chain Controller, a single Block Publisher, and a single
Executor, there are numerous instances of schedulers which are dynamically
created as needed.</p>
<div class="section" id="chain-controller">
<h3>Chain Controller<a class="headerlink" href="#chain-controller" title="Permalink to this headline">¶</a></h3>
<p>The Chain Controller is responsible for maintaining the current chain head (a
pointer to the last block in the current chain).  Processing is block-based;
when it receives a candidate block (over the network or from the Block
Publisher), it determines whether the chain head should be updated to point to
that candidate block.  The Chain Controller creates a scheduler to calculate
new state with a related Merkle hash for the block being published. The Merkle
hash is compared to the state root contained in the block header. If they
match, the block is valid from a transaction execution and state standpoint.
The Chain Controller uses this information in combination with consensus
information to determine whether to update the current chain head.</p>
</div>
<div class="section" id="block-publisher">
<h3>Block Publisher<a class="headerlink" href="#block-publisher" title="Permalink to this headline">¶</a></h3>
<p>The Block Publisher is responsible for creating new candidate blocks.  As
batches are received by the validator (from clients or other validator nodes),
they are added to the Block Publisher&#8217;s pending queue.  Only valid transactions
will be added to the next candidate block.  For timeliness, batches are added
to a scheduler as they are added to the pending queue; thus, transactions are
processed incrementally as they are received.</p>
<p>When the pending queue changes significantly, such as when the chain head has
been updated by the Chain Controller, the Block Publisher cancels the current
scheduler and creates a new scheduler.</p>
</div>
<div class="section" id="executor">
<h3>Executor<a class="headerlink" href="#executor" title="Permalink to this headline">¶</a></h3>
<p>The Executor is responsible for the execution of transactions by sending them
to transaction processors.  The overall flow for each transaction is:</p>
<ul class="simple">
<li>The Executor obtains the next transaction and initial context from the
scheduler</li>
<li>The Executor obtains a new context for the transaction from the Context
Manager by providing the initial context (contexts are chained together)</li>
<li>The Executor sends the transaction and a context reference to the transaction
processor</li>
<li>The transaction processor updates the context&#8217;s state via context manager
calls</li>
<li>The transaction processor notifies the Executor that the transaction is
complete</li>
<li>The Executor updates the scheduler with the transaction&#8217;s result with the
updated context</li>
</ul>
<p>In the case of serial scheduling, step (1) simply blocks until step (6) from
the previous transaction has completed.  For the parallel scheduler, step (1)
blocks until a transaction exists which can be executed because it&#8217;s
dependencies have been satisfied, with steps (2) through (6) happening in
parallel for each transaction being executed.</p>
</div>
</div>
<div class="section" id="iterative-scheduling">
<h2>Iterative Scheduling<a class="headerlink" href="#iterative-scheduling" title="Permalink to this headline">¶</a></h2>
<p>Each time the executor requests the next transaction, the scheduler calculates
the next transaction dynamically based on knowledge of the transaction
dependency graph and previously executed transactions within this schedule.</p>
<div class="section" id="serial-scheduler">
<h3>Serial Scheduler<a class="headerlink" href="#serial-scheduler" title="Permalink to this headline">¶</a></h3>
<p>For the serial scheduler, the dependency graph is straightforward; each
transaction is dependent on the one before it.  The next transaction is
released only when the scheduler has received the execution results from the
transaction before it.</p>
</div>
<div class="section" id="parallel-scheduler">
<h3>Parallel Scheduler<a class="headerlink" href="#parallel-scheduler" title="Permalink to this headline">¶</a></h3>
<p>As batches are added to the parallel scheduler, predecessor transactions are
calculated for each transaction in the batch.  A predecessor transaction is
a transaction which must be fully executed prior to executing the transaction
for which it is a predecessor.</p>
<p>Each transaction has a list of inputs and outputs; these are address
declarations fields in the transaction&#8217;s header and are filled in by the client
when the transaction is created. Inputs and outputs specify which locations in
state are accessed or modified by the transaction. Predecessor transactions are
determined using these inputs/outputs declarations.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is possible for poorly written clients to impact parallelism by providing
overly broad inputs/outputs declarations.  Transaction processor
implementations can enforce specific inputs/outputs requirements to
provide an incentive for correct client behavior.</p>
</div>
<p>The parallel scheduler calculates predecessors using a Radix trie with nodes
addressable by state addresses or namespaces. This tree is called the
predecessor tree. Input declarations are considered reads, with output
declarations considered writes.  By keeping track of readers and writers within
nodes of the tree, predecessors for a transaction can be quickly determined.</p>
<p>Unlike the serial scheduler, the order in which transactions will be returned
to the Executor is not predetermined.  The parallel scheduler is careful about
which transactions are returned; only transactions with do not have state
conflicts will be executed in parallel. When the Executor asks for the next
transaction, the scheduler inspects the list of unscheduled transactions; the
first in the list for which all predecessors have finished executed will be be
returned.  If none are found, the scheduler will block and re-check after
a transaction has finished being executed.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="rest_api.html" class="btn btn-neutral float-right" title="REST API" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="journal.html" class="btn btn-neutral" title="Journal" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015-2017, Intel Corporation.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'v1.0.4',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          
          SphinxRtdTheme.Navigation.enableSticky();
          
      });
  </script> 

</body>
</html>