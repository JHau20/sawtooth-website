

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Creating a Sawtooth Network &mdash; Sawtooth latest documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Playing with the XO Transaction Family" href="intro_xo_transaction_family.html" />
    <link rel="prev" title="Using Kubernetes for Your Development Environment" href="kubernetes.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../contents.html" class="icon icon-home"> Sawtooth
          

          
          </a>

          
            
            
              <div class="version">
                latest
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../app_developers_guide.html">Application Developer’s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="overview.html">Transaction Family Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="installing_sawtooth.html">Setting Up a Sawtooth Application Development Environment</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Creating a Sawtooth Network</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#about-sawtooth-networks">About Sawtooth Networks</a></li>
<li class="toctree-l3"><a class="reference internal" href="#docker-start-a-multiple-node-sawtooth-network">Docker: Start a Multiple-node Sawtooth Network</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#about-the-sawtooth-network-environment">About the Sawtooth Network Environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-1-download-the-docker-compose-file">Step 1: Download the Docker Compose File</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-2-start-the-sawtooth-network">Step 2: Start the Sawtooth Network</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-3-verify-connectivity">Step 3: Verify Connectivity</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-4-confirm-network-functionality">Step 4: Confirm Network Functionality</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-5-configure-the-allowed-transaction-types-optional">Step 5. Configure the Allowed Transaction Types (Optional)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-6-stop-the-sawtooth-network-optional">Step 6: Stop the Sawtooth Network (Optional)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#ubuntu-add-a-node-to-the-single-node-environment">Ubuntu: Add a Node to the Single-Node Environment</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">About the Sawtooth Network Environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#prereqs-multi-ubuntu-label">Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-1-configure-the-network-on-the-first-node">Step 1: Configure the Network on the First Node</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-2-set-up-the-second-validator-node">Step 2: Set Up the Second Validator Node</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-3-start-the-second-validator-node">Step 3: Start the Second Validator Node</a></li>
<li class="toctree-l4"><a class="reference internal" href="#confirm-nw-funct-ubuntu-label">Step 4: Confirm Network Functionality</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configure-txn-procs-ubuntu-label">Step 5. Configure the Allowed Transaction Types (Optional)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#kubernetes-start-a-multiple-node-sawtooth-network">Kubernetes: Start a Multiple-node Sawtooth Network</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id6">Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="#about-the-kubernetes-sawtooth-network-environment">About the Kubernetes Sawtooth Network Environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-1-install-kubectl-and-minikube">Step 1: Install kubectl and Minikube</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-2-start-and-test-minikube">Step 2: Start and Test Minikube</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-3-download-the-sawtooth-configuration-file">Step 3: Download the Sawtooth Configuration File</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-4-start-the-sawtooth-cluster">Step 4: Start the Sawtooth Cluster</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-5-confirm-network-and-blockchain-functionality">Step 5: Confirm Network and Blockchain Functionality</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-6-configure-the-allowed-transaction-types-optional">Step 6. Configure the Allowed Transaction Types (Optional)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-6-stop-the-sawtooth-kubernetes-cluster">Step 6: Stop the Sawtooth Kubernetes Cluster</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="intro_xo_transaction_family.html">Playing with the XO Transaction Family</a></li>
<li class="toctree-l2"><a class="reference internal" href="using_the_sdks.html">Using the Sawtooth SDKs</a></li>
<li class="toctree-l2"><a class="reference internal" href="no_sdk.html">Development Without an SDK</a></li>
<li class="toctree-l2"><a class="reference internal" href="address_and_namespace.html">Address and Namespace Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="namespace_restriction.html">Namespace Restriction</a></li>
<li class="toctree-l2"><a class="reference internal" href="event_subscriptions.html">Subscribing to Events</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../architecture.html">Architecture Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../transaction_family_specifications.html">Transaction Family Specifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sysadmin_guide.html">System Administrator’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_references.html">API References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli.html">CLI Command Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community.html">Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../contents.html">Sawtooth</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../contents.html">Docs</a> &raquo;</li>
        
          <li><a href="../app_developers_guide.html">Application Developer’s Guide</a> &raquo;</li>
        
      <li>Creating a Sawtooth Network</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/app_developers_guide/creating_sawtooth_network.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="creating-a-sawtooth-network">
<h1>Creating a Sawtooth Network<a class="headerlink" href="#creating-a-sawtooth-network" title="Permalink to this headline">¶</a></h1>
<p>This procedure describes how to create a Sawtooth network with multiple
validator nodes. It creates an application development environment that is
similar to the single-node environment in <a class="reference internal" href="installing_sawtooth.html"><span class="doc">Setting Up a Sawtooth Application Development Environment</span></a>, but with
a different consensus mechanism to support additional nodes.</p>
<p>You can install and run a multiple-node Sawtooth application development
environment on one of the following platforms:</p>
<ul class="simple">
<li><p>Docker: Run a Sawtooth network from prebuilt
<a class="reference external" href="https://www.docker.com/">Docker</a> containers.</p></li>
<li><p>Ubuntu: Install Sawtooth natively using
<a class="reference external" href="https://www.ubuntu.com/">Ubuntu 16.04</a>. You will add a node to an existing
application development environment that is described in <a class="reference internal" href="ubuntu.html"><span class="doc">Using Ubuntu for Your Development Environment</span></a>, but
you will delete all existing blockchain data, including the genesis block.</p></li>
<li><p>Kubernetes: Run a Sawtooth network in a <a class="reference external" href="https://kubernetes.io">Kubernetes</a>
cluster inside a virtual machine on your computer.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The guides in this chapter set up an environment with multiple Sawtooth
validator nodes. For a single-node environment, see
<a class="reference internal" href="installing_sawtooth.html"><span class="doc">Setting Up a Sawtooth Application Development Environment</span></a>.</p>
</div>
<p>To get started, choose the guide for the platform of your choice:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#proc-multi-docker-label"><span class="std std-ref">Docker: Start a Multiple-node Sawtooth Network</span></a></p></li>
<li><p><a class="reference internal" href="#proc-multi-ubuntu-label"><span class="std std-ref">Ubuntu: Add a Node to the Single-Node Environment</span></a></p></li>
<li><p><a class="reference internal" href="#proc-multi-kube-label"><span class="std std-ref">Kubernetes: Start a Multiple-node Sawtooth Network</span></a></p></li>
</ul>
<div class="section" id="about-sawtooth-networks">
<h2>About Sawtooth Networks<a class="headerlink" href="#about-sawtooth-networks" title="Permalink to this headline">¶</a></h2>
<p>A Sawtooth network has the following requirements:</p>
<ul>
<li><p>Each host system (physical computer, virtual machine, set of Docker
containers, or Kubernetes pod) must run one validator, an optional REST API,
and an identical set of transaction processors.</p>
<p>This environment includes the Sawtooth REST API on all validator nodes.
However, an application could provide a custom REST API (or no REST API). See
<a class="reference external" href="https://github.com/hyperledger/sawtooth-supply-chain">Sawtooth Supply Chain</a>
for an example of a custom REST API.</p>
</li>
<li><p>Each validator node must advertise a routable address. The Docker and
Kubernetes platforms provide preconfigured settings. For the Ubuntu platform,
you must follow the instructions in this procedure to provide this information
when starting the validator.</p></li>
<li><p>The authorization type must be the same on all nodes: either <code class="docutils literal notranslate"><span class="pre">trust</span></code>
(default) or <code class="docutils literal notranslate"><span class="pre">challenge</span></code>. This application development environment uses
<code class="docutils literal notranslate"><span class="pre">trust</span></code> authorization.</p></li>
<li><p>The genesis block is created for the first validator node only. It includes
on-chain configuration settings that will be available to the new validator
nodes once they join the network.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The first validator node on the network has no special meaning, other than
being the node that created the genesis block. Sawtooth has no concept of a
“head node” or “master node”. Once multiple nodes are up and running, each
node has the same genesis block and treats all other nodes as peers.</p>
</div>
</div>
<div class="section" id="docker-start-a-multiple-node-sawtooth-network">
<span id="proc-multi-docker-label"></span><h2>Docker: Start a Multiple-node Sawtooth Network<a class="headerlink" href="#docker-start-a-multiple-node-sawtooth-network" title="Permalink to this headline">¶</a></h2>
<p>In this procedure, you will use a Docker Compose file that creates a new
application development environment with five validator nodes and four
transaction processors (Settings, IntegerKey, XO, and PoET Validator Registry).</p>
<div class="section" id="about-the-sawtooth-network-environment">
<h3>About the Sawtooth Network Environment<a class="headerlink" href="#about-the-sawtooth-network-environment" title="Permalink to this headline">¶</a></h3>
<p>The following figure shows an example network with two validator nodes:</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/appdev-environment-multi-node.svg"><img alt="Docker: Sawtooth network with five nodes" src="../_images/appdev-environment-multi-node.svg" width="100%" /></a>
</div>
<p>Like the single-node environment, this environment uses serial transaction
processing and static peering. However, it has the following differences:</p>
<ul class="simple">
<li><p>PoET simulator consensus instead of dev mode, because dev mode’s random-leader
consensus is not recommended for multi-node or production networks. Sawtooth
offers two versions of <a class="reference internal" href="../glossary.html#term-poet"><span class="xref std std-term">PoET</span></a> consensus. PoET-SGX relies on Intel
Software Guard Extensions (SGX) to implement a leader-election lottery system.
PoET simulator provides the same consensus algorithm on an SGX simulator.</p></li>
<li><p>An additional transaction processor, PoET Validator Registry, handles PoET
settings for a multiple-node network.</p></li>
</ul>
</div>
<div class="section" id="prerequisites">
<h3>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h3>
<p>This procedure assumes that you have already created a single-node environment,
as described in <a class="reference internal" href="docker.html"><span class="doc">Using Docker for your Development Environment</span></a>. Refer to the previous procedure for more
information on each step.</p>
<p>If the single-node environment is still running, shut it down. Enter CTRL-c from
the window where you originally ran <code class="docutils literal notranslate"><span class="pre">docker-compose</span> <span class="pre">up</span></code>, then run the
following command from your host system:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> docker-compose -f sawtooth-default.yaml down
</pre></div>
</div>
<p>For more information, see <a class="reference internal" href="docker.html#stop-sawtooth-docker-label"><span class="std std-ref">Step 9: Stop the Sawtooth Environment</span></a>.</p>
</div>
<div class="section" id="step-1-download-the-docker-compose-file">
<h3>Step 1: Download the Docker Compose File<a class="headerlink" href="#step-1-download-the-docker-compose-file" title="Permalink to this headline">¶</a></h3>
<p>Download the Docker Compose file for a multiple-node network,
<a class="reference external" href="./sawtooth-default-poet.yaml">sawtooth-default-poet.yaml</a>.
Save this file in the same directory as the single-node compose file
(<code class="docutils literal notranslate"><span class="pre">sawtooth-default.yaml</span></code>).</p>
</div>
<div class="section" id="step-2-start-the-sawtooth-network">
<h3>Step 2: Start the Sawtooth Network<a class="headerlink" href="#step-2-start-the-sawtooth-network" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p>Use the following command to start the multiple-node Sawtooth network:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">user@host$</span> docker-compose -f sawtooth-default-poet.yaml up
</pre></div>
</div>
</li>
<li><p>This Compose file creates five validator nodes, numbered from 0 to 4.
Note the container names for the Sawtooth components on each node:</p>
<p><code class="docutils literal notranslate"><span class="pre">validator-0</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sawtooth-validator-default-0</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sawtooth-rest-api-default-0</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sawtooth-settings-tp-default-0</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sawtooth-intkey-tp-python-default-0</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sawtooth-xo-tp-python-default-0</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sawtooth-poet-validator-registry-tp-0</span></code></p></li>
</ul>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">validator-1</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sawtooth-validator-default-1</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sawtooth-rest-api-default-1</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sawtooth-settings-tp-default-1</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sawtooth-intkey-tp-python-default-1</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sawtooth-xo-tp-python-default-1</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sawtooth-poet-validator-registry-tp-1</span></code></p></li>
</ul>
</div></blockquote>
<p>… and so on.</p>
</li>
<li><p>Note that there is only one shell container for this Docker environment:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sawtooth-shell-default</span></code></p></li>
</ul>
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="step-3-verify-connectivity">
<h3>Step 3: Verify Connectivity<a class="headerlink" href="#step-3-verify-connectivity" title="Permalink to this headline">¶</a></h3>
<p>You can connect to a Docker container, such as
<code class="docutils literal notranslate"><span class="pre">sawtooth-poet-validator-registry-tp-0</span></code>, then use the following <code class="docutils literal notranslate"><span class="pre">ps</span></code>
command to verify that the component is running.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> ps --pid <span class="m">1</span> fw
<span class="go">PID TTY      STAT   TIME COMMAND</span>
<span class="go">1 ?        Ssl    0:04 python3 /project/sawtooth-core/bin/poet-validator-registry-tp -C tcp://validator-0:4004</span>
</pre></div>
</div>
</div>
<div class="section" id="step-4-confirm-network-functionality">
<span id="confirm-nw-funct-docker-label"></span><h3>Step 4: Confirm Network Functionality<a class="headerlink" href="#step-4-confirm-network-functionality" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p>To check whether peering has occurred on the network, submit a peers query
to the REST API on the first validator node.</p>
<p>Run the following command from the shell container,
<code class="docutils literal notranslate"><span class="pre">sawtooth-shell-default</span></code>.  This command specifies the container name and
port for the first node’s REST API.</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> curl http://sawtooth-rest-api-default-0:8008/peers
</pre></div>
</div>
</div></blockquote>
<p>If this query returns a 503 error, the nodes have not yet peered with the
Sawtooth network. Repeat the query until you see output that resembles the
following example:</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">{</span>
<span class="go">    &quot;data&quot;: [</span>
<span class="go">    &quot;tcp://validator-1:8800&quot;,</span>
<span class="go">  ],</span>
<span class="go">  &quot;link&quot;: &quot;http://rest-api:8008/peers&quot;</span>
<span class="go">}</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>(Optional) You can also connect to a validator container, such as
<code class="docutils literal notranslate"><span class="pre">sawtooth-validator-default-0</span></code>, and run the following Sawtooth commands to
show the other nodes on the network.</p>
<ol class="loweralpha simple">
<li><p>Run <code class="docutils literal notranslate"><span class="pre">sawtooth</span> <span class="pre">peer</span> <span class="pre">list</span></code> to show the peers of a particular node.</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">sawnet</span> <span class="pre">peers</span> <span class="pre">list</span></code> to display a complete graph of peers on the
network (available in Sawtooth release 1.1 and later).</p></li>
</ol>
</li>
<li><p>Submit a transaction to the REST API on the first validator node. This
example sets a key named <code class="docutils literal notranslate"><span class="pre">MyKey</span></code> to the value 999.</p>
<p>Use the shell container to run the following command.</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> intkey <span class="nb">set</span> --url http://sawtooth-rest-api-default-0:8008 MyKey <span class="m">999</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Watch for this transaction to appear on the second validator node. The
following command requests the value of <code class="docutils literal notranslate"><span class="pre">MyKey</span></code> from the REST API on the
second validator node.</p>
<p>Use the shell container to run the following command.</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> intkey show --url http://sawtooth-rest-api-default-1:8008 MyKey
<span class="go">MyKey: 999</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="step-5-configure-the-allowed-transaction-types-optional">
<span id="configure-txn-procs-docker-label"></span><h3>Step 5. Configure the Allowed Transaction Types (Optional)<a class="headerlink" href="#step-5-configure-the-allowed-transaction-types-optional" title="Permalink to this headline">¶</a></h3>
<p>By default, a validator accepts transactions from any transaction processor.
However, Sawtooth allows you to limit the types of transactions that can be
submitted.</p>
<p>In this step, you will configure the validator network to accept transactions
only from the four transaction processors in the example environment:
IntegerKey, Settings, XO, and Validator Registry. Transaction-type restrictions
are an on-chain setting, so this configuration change is applied to all
validators.</p>
<p>The <a class="reference internal" href="../transaction_family_specifications/settings_transaction_family.html"><span class="doc">Settings transaction processor</span></a>
handles on-chain configuration settings. You will use the <code class="docutils literal notranslate"><span class="pre">sawset</span></code> command to
create and submit a batch of transactions containing the configuration change.</p>
<p>Use the following steps to create and submit a batch containing the new on-chain
setting.</p>
<ol class="arabic">
<li><p>Connect to the first validator container (<code class="docutils literal notranslate"><span class="pre">sawtooth-validator-default-0</span></code>).
The next command requires the validator key that was generated in that
container.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">%</span> docker <span class="nb">exec</span> -it sawtooth-validator-default-0 bash
</pre></div>
</div>
</li>
<li><p>Run the following command from the validator container to check the setting
change.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> sawset proposal create --url http://sawtooth-rest-api-default-0:8008 --key /etc/sawtooth/keys/validator.priv <span class="se">\</span>
sawtooth.validator.transaction_families<span class="o">=</span><span class="s1">&#39;[{&quot;family&quot;: &quot;intkey&quot;, &quot;version&quot;: &quot;1.0&quot;}, {&quot;family&quot;:&quot;sawtooth_settings&quot;, &quot;version&quot;:&quot;1.0&quot;}, {&quot;family&quot;:&quot;xo&quot;, &quot;version&quot;:&quot;1.0&quot;}, {&quot;family&quot;:&quot;sawtooth_validator_registry&quot;, &quot;version&quot;:&quot;1.0&quot;}]&#39;</span>
</pre></div>
</div>
<p>This command sets <code class="docutils literal notranslate"><span class="pre">sawtooth.validator.transaction_families</span></code> to a JSON array
that specifies the family name and version of each allowed transaction
processor (defined in the transaction header of each family’s
<a class="reference internal" href="../transaction_family_specifications.html"><span class="doc">transaction family specification</span></a>).</p>
</li>
<li><p>After this command runs, a <code class="docutils literal notranslate"><span class="pre">TP_PROCESS_REQUEST</span></code> message appears in the
Settings transaction processor log.</p>
<p>You can view this log file by connecting to the <code class="docutils literal notranslate"><span class="pre">sawtooth-settings-tp</span></code>
container on any node, then examining
<code class="docutils literal notranslate"><span class="pre">/var/log/sawtooth/logs/settings-{xxxxxxx}-debug.log</span></code>. (Each Settings log
file has a unique string in the name.) This example connects to the Settings
transaction processor on the first node (<code class="docutils literal notranslate"><span class="pre">sawtooth-settings-tp-default-0</span></code>).</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">%</span> docker <span class="nb">exec</span> -it sawtooth-settings-tp-default-0 bash
<span class="gp">#</span> tail /var/log/sawtooth/settings-*-debug.log
<span class="go"> .</span>
<span class="go"> .</span>
<span class="go"> .</span>
<span class="go"> [22:18:33.137 [MainThread] core DEBUG] received message of type: TP_PROCESS_REQUEST</span>
<span class="go"> [22:18:33.219 [MainThread] handler INFO] Setting setting sawtooth.validator.transaction_families changed from None to [{&quot;family&quot;: &quot;intkey&quot;, &quot;version&quot;: &quot;1.0&quot;}, {&quot;family&quot;:&quot;sawtooth_settings&quot;, &quot;version&quot;:&quot;1.0&quot;}, {&quot;family&quot;:&quot;xo&quot;, &quot;version&quot;:&quot;1.0&quot;}, {&quot;family&quot;:&quot;sawtooth_validator_registry&quot;, &quot;version&quot;:&quot;1.0&quot;}]</span>
</pre></div>
</div>
</li>
<li><p>Run the following command to check the setting change. You can use any
container for this step. Also, you can specify any REST API on the network;
this example uses the REST API on the first validator node.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> sawtooth settings list --url http://sawtooth-rest-api-default-0:8008
</pre></div>
</div>
<p>The output should be similar to this example:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sawtooth.consensus.algorithm: poet</span>
<span class="go">sawtooth.poet.initial_wait_time: 15</span>
<span class="go">sawtooth.poet.key_block_claim_limit: 100000</span>
<span class="go">sawtooth.poet.report_public_key_pem: -----BEGIN PUBL...</span>
<span class="go">sawtooth.poet.target_wait_time: 15</span>
<span class="go">sawtooth.poet.valid_enclave_basenames: b785c58b77152cb...</span>
<span class="go">sawtooth.poet.valid_enclave_measurements: c99f21955e38dbb...</span>
<span class="go">sawtooth.poet.ztest_minimum_win_count: 100000</span>
<span class="go">sawtooth.publisher.max_batches_per_block: 200</span>
<span class="go">sawtooth.settings.vote.authorized_keys: 03e27504580fa15...</span>
<span class="go">sawtooth.validator.transaction_families: [{&quot;family&quot;: &quot;in...</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="step-6-stop-the-sawtooth-network-optional">
<h3>Step 6: Stop the Sawtooth Network (Optional)<a class="headerlink" href="#step-6-stop-the-sawtooth-network-optional" title="Permalink to this headline">¶</a></h3>
<p>If you need to stop or reset the multiple-node Sawtooth environment, enter
CTRL-c in the window where you ran <code class="docutils literal notranslate"><span class="pre">docker-compose</span> <span class="pre">up</span></code>, then run the following
command from your host system:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">user@host$</span> docker-compose -f sawtooth-default-poet.yaml down
</pre></div>
</div>
</div>
</div>
<div class="section" id="ubuntu-add-a-node-to-the-single-node-environment">
<span id="proc-multi-ubuntu-label"></span><h2>Ubuntu: Add a Node to the Single-Node Environment<a class="headerlink" href="#ubuntu-add-a-node-to-the-single-node-environment" title="Permalink to this headline">¶</a></h2>
<p>This procedure describes how to add a second validator node to an existing
single-node application development environment, as described in <a class="reference internal" href="ubuntu.html"><span class="doc">Using Ubuntu for Your Development Environment</span></a>.
You will stop the Sawtooth components on the first node and delete the
existing blockchain data, then create a new genesis block that specifies PoET
simulator consensus and related settings. All nodes on the network will run four
transaction processors (Settings, IntegerKey, XO, and PoET Validator Registry).</p>
<div class="section" id="id1">
<h3>About the Sawtooth Network Environment<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>The following figure shows an example network with two validator nodes:</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/appdev-environment-two-nodes.svg"><img alt="Ubuntu: Sawtooth network with two nodes" src="../_images/appdev-environment-two-nodes.svg" width="100%" /></a>
</div>
<p>Like the single-node environment, this environment uses serial transaction
processing and static peering. However, it has the following differences:</p>
<ul class="simple">
<li><p>PoET simulator consensus instead of dev mode, because dev mode’s random-leader
consensus is not recommended for multi-node or production networks. Sawtooth
offers two versions of <a class="reference internal" href="../glossary.html#term-poet"><span class="xref std std-term">PoET</span></a> consensus. PoET-SGX relies on Intel
Software Guard Extensions (SGX) to implement a leader-election lottery system.
PoET simulator provides the same consensus algorithm on an SGX simulator.</p></li>
<li><p>An additional transaction processor, PoET Validator Registry, handles PoET
settings for a multiple-node network.</p></li>
</ul>
</div>
<div class="section" id="prereqs-multi-ubuntu-label">
<span id="id2"></span><h3>Prerequisites<a class="headerlink" href="#prereqs-multi-ubuntu-label" title="Permalink to this headline">¶</a></h3>
<p>This procedure assumes that you have created a working (runnable) validator node
with a validator, REST API, and the Settings, IntegerKey, and XO transaction
processors. For more information, see <a class="reference internal" href="ubuntu.html"><span class="doc">Using Ubuntu for Your Development Environment</span></a>.</p>
<p>For each validator node that will be on your network, gather the following
information:</p>
<ul class="simple">
<li><p><strong>Component bind string</strong>: Where this validator will listen for incoming
communication from this validator’s components. You will set this value with
<code class="docutils literal notranslate"><span class="pre">--bind</span> <span class="pre">component</span></code> when starting the validator. Default:
<code class="docutils literal notranslate"><span class="pre">tcp://127.0.0.1:4004</span></code>.</p></li>
<li><p><strong>Network bind string</strong>: Where this validator will listen for incoming
communication from other validator nodes (also called peers). You will set
this value with <code class="docutils literal notranslate"><span class="pre">--bind</span> <span class="pre">network</span></code> when starting the validator.  Default:
<code class="docutils literal notranslate"><span class="pre">tcp://127.0.0.1:8800</span></code>.</p></li>
<li><p><strong>Public endpoint string</strong>: The address that other peers should use to
find this validator node. You will set this value with <code class="docutils literal notranslate"><span class="pre">--endpoint</span></code> when
starting the validator. You will also specify this value in the peers list
when starting a validator on another node. Default: <code class="docutils literal notranslate"><span class="pre">tcp://127.0.0.1:8800</span></code>.</p></li>
<li><p><strong>Peers list</strong>: The addresses that this validator should use to connect to
the other validator nodes (peers); that is, the public endpoint strings of
those nodes. You will set this value with <code class="docutils literal notranslate"><span class="pre">--peers</span></code> when starting the
validator. Default: none.</p></li>
</ul>
<div class="section" id="about-component-and-network-bind-strings">
<span id="about-bind-strings-label"></span><h4>About component and network bind strings<a class="headerlink" href="#about-component-and-network-bind-strings" title="Permalink to this headline">¶</a></h4>
<p>For the network bind string and component bind string, you would typically use
a specific network interface that you want to bind to.
The <code class="docutils literal notranslate"><span class="pre">ifconfig</span></code> command provides an easy way to determine what this interface
should be. <code class="docutils literal notranslate"><span class="pre">ifconfig</span></code> displays the network interfaces on your host system,
along with additional information about the interfaces. For example:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ifconfig
<span class="go">eth0      Link encap:Ethernet  HWaddr ...</span>
<span class="go">          inet addr:...  Bcast:...  Mask:255.255.0.0</span>
<span class="go">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span>
<span class="go">          RX packets:17964 errors:0 dropped:0 overruns:0 frame:0</span>
<span class="go">          TX packets:6134 errors:0 dropped:0 overruns:0 carrier:0</span>
<span class="go">          collisions:0 txqueuelen:0</span>
<span class="go">          RX bytes:26335425 (26.3 MB)  TX bytes:338394 (338.3 KB)</span>
<span class="go">lo        Link encap:Local Loopback</span>
<span class="go">          inet addr:127.0.0.1  Mask:255.0.0.0</span>
<span class="go">          UP LOOPBACK RUNNING  MTU:65536  Metric:1</span>
<span class="go">          RX packets:0 errors:0 dropped:0 overruns:0 frame:0</span>
<span class="go">          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0</span>
<span class="go">          collisions:0 txqueuelen:1</span>
<span class="go">          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)</span>
</pre></div>
</div>
<p>This example output shows that <code class="docutils literal notranslate"><span class="pre">eth0</span></code> is a network interface that has access
to the Internet. In this case, you could use one of the following:</p>
<ul class="simple">
<li><p>If you would like the validator node to accept connections from other
validator nodes on the network behind <code class="docutils literal notranslate"><span class="pre">eth0</span></code>, you could specify a
network bind string such as <code class="docutils literal notranslate"><span class="pre">tcp://eth0:8800</span></code>.</p></li>
<li><p>If you would like the validator node to accept only connections from local
Sawtooth components, you could specify the component bind string
<code class="docutils literal notranslate"><span class="pre">tcp://lo:4004</span></code>. Note that this is equivalent to <code class="docutils literal notranslate"><span class="pre">tcp://127.0.0.1:4004</span></code>.</p></li>
</ul>
<p>For more information on how to specify the component and network bind strings,
see “Assigning a local address to a socket” in the
<a class="reference external" href="http://api.zeromq.org/4-2:zmq-tcp">zmq-tcp API Reference</a>.</p>
</div>
<div class="section" id="about-the-public-endpoint-string">
<span id="about-endpoint-string-label"></span><h4>About the public endpoint string<a class="headerlink" href="#about-the-public-endpoint-string" title="Permalink to this headline">¶</a></h4>
<p>The correct value for your public endpoint string depends on your network
configuration.</p>
<ul>
<li><p>If this network is for development purposes and all of the validator nodes
will be on the same local network, the IP address returned by <code class="docutils literal notranslate"><span class="pre">ifconfig</span></code>
should work as your public endpoint string.</p></li>
<li><p>If part of your network is behind a NAT or firewall, or if you want to start
up a public network on the Internet, you must determine the correct routable
values for all the validator nodes in your network.</p>
<p>Determining these values for a distributed or production network is an
advanced networking topic that is beyond the scope of this guide. Contact your
network administrator for help with this task.</p>
</li>
</ul>
<p>For information on how to specify the public endpoint string, see “Connecting
a socket” in the <a class="reference external" href="http://api.zeromq.org/4-2:zmq-tcp">zmq-tcp API Reference</a>.</p>
</div>
</div>
<div class="section" id="step-1-configure-the-network-on-the-first-node">
<h3>Step 1: Configure the Network on the First Node<a class="headerlink" href="#step-1-configure-the-network-on-the-first-node" title="Permalink to this headline">¶</a></h3>
<p>This step assumes an existing application development environment as described
in <a class="reference internal" href="ubuntu.html"><span class="doc">Using Ubuntu for Your Development Environment</span></a>.</p>
<ol class="arabic">
<li><p>If the first validator node is running, stop the Sawtooth components
(validator, REST API, and transaction processors), as described
in <a class="reference internal" href="ubuntu.html#stop-sawtooth-ubuntu-label"><span class="std std-ref">Step 12: Stop Sawtooth Components</span></a>.</p></li>
<li><p>Delete any existing blockchain data by removing all files from
<code class="docutils literal notranslate"><span class="pre">/var/lib/sawtooth/</span></code>.</p></li>
<li><p>(Optional) Delete existing logs by removing all files from
<code class="docutils literal notranslate"><span class="pre">/var/log/sawtooth/</span></code>.</p></li>
<li><p>Ensure that the required user and validator keys exist:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ls ~/.sawtooth/keys/
<span class="go">{yourname}.priv    {yourname}.pub</span>

<span class="gp">$</span> ls /etc/sawtooth/keys/
<span class="go">validator.priv   validator.pub</span>
</pre></div>
</div>
<p>If these key files do not exist, create them as described in
<a class="reference internal" href="ubuntu.html#generate-user-key-ubuntu"><span class="std std-ref">Step 2: Generate a User Key</span></a>
and <a class="reference internal" href="ubuntu.html#generate-root-key-ubuntu"><span class="std std-ref">Step 4: Generate the Root Key for the Validator</span></a>.</p>
</li>
<li><p>Create a batch to initialize the Settings transaction family in the genesis
block.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sawset genesis -k /etc/sawtooth/keys/validator.priv -o config-genesis.batch
</pre></div>
</div>
</li>
<li><p>Create a batch to initialize the PoET consensus settings. This command sets
the consensus algorithm to PoET simulator, and then applies the required
settings.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sawset proposal create -k /etc/sawtooth/keys/validator.priv <span class="se">\</span>
-o config.batch <span class="se">\</span>
sawtooth.consensus.algorithm.name<span class="o">=</span>PoET <span class="se">\</span>
sawtooth.consensus.algorithm.version<span class="o">=</span><span class="m">0</span>.1 <span class="se">\</span>
sawtooth.poet.report_public_key_pem<span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>cat /etc/sawtooth/simulator_rk_pub.pem<span class="k">)</span><span class="s2">&quot;</span> <span class="se">\</span>
sawtooth.poet.valid_enclave_measurements<span class="o">=</span><span class="k">$(</span>poet enclave measurement<span class="k">)</span> <span class="se">\</span>
sawtooth.poet.valid_enclave_basenames<span class="o">=</span><span class="k">$(</span>poet enclave basename<span class="k">)</span>
</pre></div>
</div>
</li>
<li><p>Create a batch to register the first validator with the Validator
Registry. Without this command, the validator would not be able to publish
any blocks.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> poet registration create -k /etc/sawtooth/keys/validator.priv -o poet.batch
</pre></div>
</div>
</li>
<li><p>(Optional) Create a batch to configure optional PoET settings.  This example
shows the default settings.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sawset proposal create -k /etc/sawtooth/keys/validator.priv <span class="se">\</span>
-o poet-settings.batch <span class="se">\</span>
sawtooth.poet.target_wait_time<span class="o">=</span><span class="m">5</span> <span class="se">\</span>
sawtooth.poet.initial_wait_time<span class="o">=</span><span class="m">25</span> <span class="se">\</span>
sawtooth.publisher.max_batches_per_block<span class="o">=</span><span class="m">100</span>
</pre></div>
</div>
</li>
<li><p>Combine the previously created batches into a single genesis batch that will
be committed in the genesis block.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sawadm genesis config-genesis.batch config.batch poet.batch poet-settings.batch
</pre></div>
</div>
</li>
<li><p>Use the following command to start the validator on the first node.
Substitute your actual values for the component and network bind strings,
public endpoint string, and peer list, as described in
<a class="reference internal" href="#prereqs-multi-ubuntu-label"><span class="std std-ref">Prerequisites</span></a>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sudo -u sawtooth sawtooth-validator <span class="se">\</span>
--bind component:<span class="o">{</span>component-bind-string<span class="o">}</span> <span class="se">\</span>
--bind network:<span class="o">{</span>network-bind-string<span class="o">}</span> <span class="se">\</span>
--endpoint <span class="o">{</span>public-endpoint-string<span class="o">}</span> <span class="se">\</span>
--peers <span class="o">{</span>peer-list<span class="o">}</span>
</pre></div>
</div>
<p>For example, the following command uses the component bind address
<code class="docutils literal notranslate"><span class="pre">127.0.0.1:4004</span></code> (the default value), the network bind address and endpoint
<code class="docutils literal notranslate"><span class="pre">192.0.2.0:8800</span></code> (a TEST-NET-1 example address), and one peer at the public
endpoint <code class="docutils literal notranslate"><span class="pre">203.0.113.0:8800</span></code>.</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sudo -u sawtooth sawtooth-validator <span class="se">\</span>
--bind component:tcp://127.0.0.1:4004 <span class="se">\</span>
--bind network:tcp://192.0.2.0:8800 <span class="se">\</span>
--endpoint tcp://192.0.2.0:8800 <span class="se">\</span>
--peers tcp://203.0.113.0:8800
</pre></div>
</div>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Specify multiple peers in a comma-separated list, as in this example:</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>--peers tcp://203.0.113.0:8800,198.51.100.0:8800
</pre></div>
</div>
</div></blockquote>
</div>
</li>
<li><p>Open a separate terminal window and start the REST API on the first validator
node.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sudo -u sawtooth sawtooth-rest-api -v
</pre></div>
</div>
<p>If necessary, use the <code class="docutils literal notranslate"><span class="pre">--connect</span></code> option to specify a non-default value for
the validator’s component bind address and port, as described in
<a class="reference internal" href="#prereqs-multi-ubuntu-label"><span class="std std-ref">Prerequisites</span></a>. The following example shows the default
value:</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ sudo -u sawtooth sawtooth-rest-api -v --connect 127.0.0.1:4004
</pre></div>
</div>
</div></blockquote>
<p>For more information, see <a class="reference internal" href="ubuntu.html#start-rest-api-label"><span class="std std-ref">Step 7: Start the REST API</span></a>.</p>
</li>
<li><p>Start the transaction processors on the first validator node. Open a separate
terminal window to start each component.</p>
<p>As with the previous command, use the <code class="docutils literal notranslate"><span class="pre">--connect</span></code> option for each command,
if necessary, to specify a non-default value for validator’s component bind
address and port.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sudo -u sawtooth settings-tp -v
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sudo -u sawtooth intkey-tp-python -v
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sudo -u sawtooth xo-tp-python -v
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sudo -u sawtooth poet-validator-registry-tp -v
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This network requires the Settings transaction processor, <code class="docutils literal notranslate"><span class="pre">settings-tp</span></code>,
and the PoET Validator Registry transaction processor,
<code class="docutils literal notranslate"><span class="pre">poet-validator-registry-tp</span></code>.
The other transaction processors (<code class="docutils literal notranslate"><span class="pre">intkey-tp-python</span></code> and
<code class="docutils literal notranslate"><span class="pre">xo-tp-python</span></code>) are not required, but are used for the other tutorials
in this guide. Note that each node in the network must run the same
transaction processors.</p>
</div>
<p>For more information, see <a class="reference internal" href="ubuntu.html#start-tps-label"><span class="std std-ref">Step 8: Start the Transaction Processors</span></a>.</p>
</li>
</ol>
</div>
<div class="section" id="step-2-set-up-the-second-validator-node">
<span id="install-second-val-ubuntu-label"></span><h3>Step 2: Set Up the Second Validator Node<a class="headerlink" href="#step-2-set-up-the-second-validator-node" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p>Install Sawtooth on the second node, as described in Step 1 of
<a class="reference internal" href="ubuntu.html"><span class="doc">Using Ubuntu for Your Development Environment</span></a>.</p></li>
<li><p>Create your user key:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sawtooth keygen
<span class="go">writing file: /home/{yourname}/.sawtooth/keys/{yourname}.priv</span>
<span class="go">writing file: /home/{yourname}/.sawtooth/keys/{yourname}.pub</span>
</pre></div>
</div>
</li>
<li><p>Create the root key for the validator:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sudo sawadm keygen
<span class="go">writing file: /etc/sawtooth/keys/validator.priv</span>
<span class="go">writing file: /etc/sawtooth/keys/validator.pub</span>
</pre></div>
</div>
</li>
</ol>
<p>If you have additional nodes, repeat this step on those nodes.</p>
</div>
<div class="section" id="step-3-start-the-second-validator-node">
<h3>Step 3: Start the Second Validator Node<a class="headerlink" href="#step-3-start-the-second-validator-node" title="Permalink to this headline">¶</a></h3>
<p>This step starts all the Sawtooth components on the second node. When the second
validator fully starts, it will peer with the first validator node.</p>
<ol class="arabic">
<li><p>Open a new terminal window on the second node, then use the following command
to start the validator. Use the actual values for the component and network
bind strings, public endpoint string, and peer list, as described in
<a class="reference internal" href="#prereqs-multi-ubuntu-label"><span class="std std-ref">Prerequisites</span></a>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sudo -u sawtooth sawtooth-validator <span class="se">\</span>
--bind component:<span class="o">{</span>component-bind-string<span class="o">}</span> <span class="se">\</span>
--bind network:<span class="o">{</span>network-bind-string<span class="o">}</span> <span class="se">\</span>
--endpoint <span class="o">{</span>public-endpoint-string<span class="o">}</span> <span class="se">\</span>
--peers <span class="o">{</span>peer-list<span class="o">}</span>
</pre></div>
</div>
<p>For example, the following command uses the component bind address
<code class="docutils literal notranslate"><span class="pre">127.0.0.1:4004</span></code> (the default value), the network bind address and
endpoint <code class="docutils literal notranslate"><span class="pre">203.0.113.0:8800</span></code> (a TEST-NET-3 example address), and a peer (the
first node) at the public endpoint <code class="docutils literal notranslate"><span class="pre">192.0.2.0:8800</span></code>.</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sudo -u sawtooth sawtooth-validator <span class="se">\</span>
--bind component:tcp://127.0.0.1:4004 <span class="se">\</span>
--bind network:tcp://203.0.113.0:8800 <span class="se">\</span>
--endpoint tcp://203.0.113.0:8800 <span class="se">\</span>
--peers tcp://192.0.2.0:8800
</pre></div>
</div>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Specify multiple peers in a comma-separated list, as in this example:</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>--peers tcp://192.0.2.0:8800,tcp://198.51.100.0:8800
</pre></div>
</div>
</div></blockquote>
</div>
</li>
<li><p>Open a separate terminal window and start the REST API on the second
validator node.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sudo -u sawtooth sawtooth-rest-api -v
</pre></div>
</div>
<p>If necessary, use the <code class="docutils literal notranslate"><span class="pre">--connect</span></code> option to specify a non-default value for
the validator’s component bind address and port, as described in
<a class="reference internal" href="#prereqs-multi-ubuntu-label"><span class="std std-ref">Prerequisites</span></a>. The following example shows the default
value:</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ sudo -u sawtooth sawtooth-rest-api -v --connect 127.0.0.1:4004
</pre></div>
</div>
</div></blockquote>
<p>For more information, see <a class="reference internal" href="ubuntu.html#start-rest-api-label"><span class="std std-ref">Step 7: Start the REST API</span></a>.</p>
</li>
<li><p>Start the transaction processors on the second validator node. Open a
separate terminal window to start each component.</p>
<p>As with the previous command, use the <code class="docutils literal notranslate"><span class="pre">--connect</span></code> option for each command,
if necessary, to specify a non-default value for validator’s component bind
address and port.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Start the same transaction processors that are running on the first
validator node. For example, if you chose not to start
<code class="docutils literal notranslate"><span class="pre">intkey-tp-python</span></code> and <code class="docutils literal notranslate"><span class="pre">xo-tp-python</span></code> on the first node, do not start
them on this node.</p>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sudo -u sawtooth settings-tp -v
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sudo -u sawtooth intkey-tp-python -v
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sudo -u sawtooth xo-tp-python -v
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sudo -u sawtooth poet-validator-registry-tp -v
</pre></div>
</div>
<p>For more information, see <a class="reference internal" href="ubuntu.html#start-tps-label"><span class="std std-ref">Step 8: Start the Transaction Processors</span></a>.</p>
</li>
</ol>
<p>If you have additional nodes in the network, repeat this step on those nodes.</p>
</div>
<div class="section" id="confirm-nw-funct-ubuntu-label">
<span id="id4"></span><h3>Step 4: Confirm Network Functionality<a class="headerlink" href="#confirm-nw-funct-ubuntu-label" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p>To check whether peering has occurred on the network, submit a peers query
to the REST API on the first validator node.</p>
<p>Open a terminal window on the first validator node and run the following
command.</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> curl http://localhost:8008/peers
</pre></div>
</div>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This environment runs a local REST API on each validator node. For
a node that is not running a local REST API, you must replace
<code class="docutils literal notranslate"><span class="pre">localhost:8008</span></code> with the externally advertised IP address and
port.  (Non-default values are set with the <code class="docutils literal notranslate"><span class="pre">--bind</span></code> option when
starting the REST API.)</p>
</div>
<p>If this query returns a 503 error, the nodes have not yet peered with the
Sawtooth network. Repeat the query until you see output that resembles the
following example:</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">{</span>
<span class="go">    &quot;data&quot;: [</span>
<span class="go">    &quot;tcp://validator-1:8800&quot;,</span>
<span class="go">  ],</span>
<span class="go">  &quot;link&quot;: &quot;http://rest-api:8008/peers&quot;</span>
<span class="go">}</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>(Optional) You can also run the following Sawtooth commands on a validator
node to show the other nodes on the network.</p>
<ol class="loweralpha simple">
<li><p>Run <code class="docutils literal notranslate"><span class="pre">sawtooth</span> <span class="pre">peer</span> <span class="pre">list</span></code> to show the peers of a particular node.</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">sawnet</span> <span class="pre">peers</span> <span class="pre">list</span></code> to display a complete graph of peers on the
network (available in Sawtooth release 1.1 and later).</p></li>
</ol>
</li>
<li><p>Submit a transaction to the REST API on the first validator node. This
example sets a key named <code class="docutils literal notranslate"><span class="pre">MyKey</span></code> to the value 999.</p>
<p>Run the following command in a terminal window on the first validator node.</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> intkey <span class="nb">set</span> MyKey <span class="m">999</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Watch for this transaction to appear on the second validator node. The
following command requests the value of <code class="docutils literal notranslate"><span class="pre">MyKey</span></code> from the REST API on the
second validator node.</p>
<p>Open a terminal window on the second validator node to run the
following command.</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> intkey show MyKey
<span class="go">MyKey: 999</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="configure-txn-procs-ubuntu-label">
<span id="id5"></span><h3>Step 5. Configure the Allowed Transaction Types (Optional)<a class="headerlink" href="#configure-txn-procs-ubuntu-label" title="Permalink to this headline">¶</a></h3>
<p>By default, a validator accepts transactions from any transaction processor.
However, Sawtooth allows you to limit the types of transactions that can be
submitted.</p>
<p>In this step, you will configure the validator network to accept transactions
only from the four transaction processors in the example environment:
IntegerKey, Settings, XO, and Validator Registry. Transaction-type restrictions
are an on-chain setting, so this configuration change is applied to all
validators.</p>
<p>The <a class="reference internal" href="../transaction_family_specifications/settings_transaction_family.html"><span class="doc">Settings transaction processor</span></a>
handles on-chain configuration settings. You can use the <code class="docutils literal notranslate"><span class="pre">sawset</span></code> command to
create and submit a batch of transactions containing the configuration change.</p>
<p>Use the following steps to create and submit a batch containing the new on-chain
setting.</p>
<ol class="arabic">
<li><p>Open a terminal window on the first validator node (node 0).  The next
command requires the validator key that was generated on that node.</p></li>
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">sawset</span></code> command to create and submit a batch of transactions
containing the configuration change.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> sawset proposal create --key /etc/sawtooth/keys/validator.priv <span class="se">\</span>
sawtooth.validator.transaction_families<span class="o">=</span><span class="s1">&#39;[{&quot;family&quot;: &quot;intkey&quot;, &quot;version&quot;: &quot;1.0&quot;}, {&quot;family&quot;:&quot;sawtooth_settings&quot;, &quot;version&quot;:&quot;1.0&quot;}, {&quot;family&quot;:&quot;xo&quot;, &quot;version&quot;:&quot;1.0&quot;}, {&quot;family&quot;:&quot;sawtooth_validator_registry&quot;, &quot;version&quot;:&quot;1.0&quot;}]&#39;</span>
</pre></div>
</div>
<p>This command sets <code class="docutils literal notranslate"><span class="pre">sawtooth.validator.transaction_families</span></code> to a JSON array
that specifies the family name and version of each allowed transaction
processor (defined in the transaction header of each family’s
<a class="reference internal" href="../transaction_family_specifications.html"><span class="doc">transaction family specification</span></a>).</p>
</li>
<li><p>After this command runs, a <code class="docutils literal notranslate"><span class="pre">TP_PROCESS_REQUEST</span></code> message appears in the log
for the Settings transaction processor.</p>
<p>You can examine the log file,
<code class="docutils literal notranslate"><span class="pre">/var/log/sawtooth/logs/settings-{xxxxxxx}-debug.log</span></code>, on any node. (Each
Settings log file has a unique string in the name.) The messages will
resemble this example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[20:07:58.039 [MainThread] core DEBUG] received message of type: TP_PROCESS_REQUEST
[20:07:58.190 [MainThread] handler INFO] Setting setting sawtooth.validator.transaction_families changed from None to [{&quot;family&quot;: &quot;intkey&quot;, &quot;version&quot;: &quot;1.0&quot;}, {&quot;family&quot;:&quot;sawtooth_settings&quot;, &quot;version&quot;:&quot;1.0&quot;}, {&quot;family&quot;:&quot;xo&quot;, &quot;version&quot;:&quot;1.0&quot;}, {&quot;family&quot;:&quot;sawtooth_validator_registry&quot;, &quot;version&quot;:&quot;1.0&quot;}]
</pre></div>
</div>
</li>
<li><p>Run the following command to check the setting change.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> sawtooth settings list
</pre></div>
</div>
<p>The output should be similar to this example:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sawtooth.consensus.algorithm.name: PoET</span>
<span class="go">sawtooth.consensus.algorithm.version: 0.1</span>
<span class="go">sawtooth.poet.initial_wait_time: 15</span>
<span class="go">sawtooth.poet.key_block_claim_limit: 100000</span>
<span class="go">sawtooth.poet.report_public_key_pem: -----BEGIN PUBL...</span>
<span class="go">sawtooth.poet.target_wait_time: 15</span>
<span class="go">sawtooth.poet.valid_enclave_basenames: b785c58b77152cb...</span>
<span class="go">sawtooth.poet.valid_enclave_measurements: c99f21955e38dbb...</span>
<span class="go">sawtooth.poet.ztest_minimum_win_count: 100000</span>
<span class="go">sawtooth.publisher.max_batches_per_block: 200</span>
<span class="go">sawtooth.settings.vote.authorized_keys: 03e27504580fa15...</span>
<span class="go">sawtooth.validator.transaction_families: [{&quot;family&quot;: &quot;in...</span>
</pre></div>
</div>
</li>
</ol>
</div>
</div>
<div class="section" id="kubernetes-start-a-multiple-node-sawtooth-network">
<span id="proc-multi-kube-label"></span><h2>Kubernetes: Start a Multiple-node Sawtooth Network<a class="headerlink" href="#kubernetes-start-a-multiple-node-sawtooth-network" title="Permalink to this headline">¶</a></h2>
<p>This procedure explains how to create a Hyperledger Sawtooth network with
<a class="reference external" href="https://kubernetes.io/docs/concepts/overview/what-is-kubernetes/">Kubernetes</a>.
This environment uses <a class="reference external" href="https://kubernetes.io/docs/setup/minikube/">Minikube</a>
to deploy Sawtooth as a containerized application in a local Kubernetes cluster
inside a virtual machine (VM) on your computer.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This environment has five Sawtooth validator nodes. For a single-node
environment, see <a class="reference internal" href="installing_sawtooth.html"><span class="doc">Setting Up a Sawtooth Application Development Environment</span></a>.</p>
</div>
<p>This procedure walks you through the following tasks:</p>
<blockquote>
<div><ul class="simple">
<li><p>Installing <code class="docutils literal notranslate"><span class="pre">kubectl</span></code> and Minikube</p></li>
<li><p>Starting Minikube</p></li>
<li><p>Starting Sawtooth in a Kubernetes cluster</p></li>
<li><p>Connecting to the Sawtooth shell containers</p></li>
<li><p>Verifying network and blockchain functionality</p></li>
<li><p>Stopping Sawtooth and deleting the Kubernetes cluster</p></li>
</ul>
</div></blockquote>
<div class="section" id="id6">
<h3>Prerequisites<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>This application development environment requires
<a class="reference external" href="https://kubernetes.io/docs/concepts/overview/object-management-kubectl/overview/">kubectl</a>
and
<a class="reference external" href="https://kubernetes.io/docs/setup/minikube/">Minikube</a> with a supported VM
hypervisor, such as VirtualBox.</p>
</div>
<div class="section" id="about-the-kubernetes-sawtooth-network-environment">
<h3>About the Kubernetes Sawtooth Network Environment<a class="headerlink" href="#about-the-kubernetes-sawtooth-network-environment" title="Permalink to this headline">¶</a></h3>
<p>This environment is a network of five Sawtooth node. Each node has a
<a class="reference internal" href="../glossary.html#term-validator"><span class="xref std std-term">validator</span></a>, a <a class="reference internal" href="../glossary.html#term-rest-api"><span class="xref std std-term">REST API</span></a>, and four
<a class="reference internal" href="../glossary.html#term-transaction-processor"><span class="xref std std-term">transaction processors</span></a>. This environment uses
<a class="reference internal" href="../introduction.html#dynamic-consensus-label"><span class="std std-ref">PoET mode consensus</span></a>,
<a class="reference internal" href="../architecture/scheduling.html"><span class="doc">serial transaction processing</span></a>,
and static peering (all-to-all)</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/appdev-environment-multi-node-kube.svg"><img alt="Kubernetes: Sawtooth network with five nodes" src="../_images/appdev-environment-multi-node-kube.svg" width="100%" /></a>
</div>
<p>The Kubernetes cluster has a pod for each Sawtooth node. On each pod, there are
containers for each Sawtooth component. The Sawtooth nodes are connected in
an all-to-all peering relationship.</p>
<p>After the cluster is running, you can use the <a class="reference external" href="https://kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/">Kubernetes dashboard</a>
to view pod status, container names, Sawtooth log files, and more.</p>
<p>This example environment includes the following transaction processors:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference internal" href="../transaction_family_specifications/settings_transaction_family.html"><span class="doc">Settings</span></a>
handles Sawtooth’s on-chain settings. The Settings transaction processor,
<code class="docutils literal notranslate"><span class="pre">settings-tp</span></code>, is required for this environment.</p></li>
<li><p><a class="reference internal" href="../transaction_family_specifications/validator_registry_transaction_family.html"><span class="doc">PoET Validator Registry</span></a>
configures PoET consensus and handles a network with multiple validators.</p></li>
<li><p><a class="reference internal" href="../transaction_family_specifications/integerkey_transaction_family.html"><span class="doc">IntegerKey</span></a>
is a basic application (also called transaction family) that introduces
Sawtooth functionality. The <code class="docutils literal notranslate"><span class="pre">sawtooth-intkey-tp-python</span></code> transaction
processor works with the <code class="docutils literal notranslate"><span class="pre">int-key</span></code> client, which has shell commands to
perform integer-based transactions.</p></li>
<li><p><a class="reference internal" href="../transaction_family_specifications/xo_transaction_family.html"><span class="doc">XO</span></a>
is a simple application for playing a game of tic-tac-toe on the blockchain.
The <code class="docutils literal notranslate"><span class="pre">sawtooth-xo-tp-python</span></code> transaction processor works with the <code class="docutils literal notranslate"><span class="pre">xo</span></code>
client, which has shell commands to define players and play a game.
XO is described in a later tutorial.</p></li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Sawtooth provides the Settings transaction processor as a reference
implementation. In a production environment, you must always run the
Settings transaction processor or an equivalent that supports the
<a class="reference internal" href="../transaction_family_specifications/settings_transaction_family.html"><span class="doc">Sawtooth methodology for storing on-chain configuration settings</span></a>.</p>
</div>
</div>
<div class="section" id="step-1-install-kubectl-and-minikube">
<h3>Step 1: Install kubectl and Minikube<a class="headerlink" href="#step-1-install-kubectl-and-minikube" title="Permalink to this headline">¶</a></h3>
<p>This step summarizes the Kubernetes installation procedures. For more
information, see the
<a class="reference external" href="https://kubernetes.io/docs/tasks/">Kubernetes documentation</a>.</p>
<ol class="arabic">
<li><p>Install a virtual machine (VM) hypervisor such as VirtualBox, VMWare,
KVM-QEMU, or Hyperkit. The steps in this procedure assume
<a class="reference external" href="https://www.virtualbox.org/wiki/Downloads">VirtualBox</a> (the default).</p></li>
<li><p>Install the <code class="docutils literal notranslate"><span class="pre">kubectl</span></code> command as described in the Kubernetes document
<a class="reference external" href="https://kubernetes.io/docs/tasks/tools/install-kubectl/">Install kubectl</a>.</p>
<ul>
<li><p>Linux quick reference:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ curl -Lo kubectl https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl \
&amp;&amp; chmod +x kubectl &amp;&amp; sudo cp kubectl /usr/local/bin/ &amp;&amp; rm kubectl
</pre></div>
</div>
</li>
<li><p>Mac quick reference:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ curl -Lo kubectl https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/darwin/amd64/kubectl \
&amp;&amp; chmod +x kubectl &amp;&amp; sudo cp kubectl /usr/local/bin/ &amp;&amp; rm kubectl
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>Install <code class="docutils literal notranslate"><span class="pre">minikube</span></code> as described in the Kubernetes document
<a class="reference external" href="https://kubernetes.io/docs/tasks/tools/install-minikube/">Install Minikube</a>.</p>
<ul>
<li><p>Linux quick reference:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ curl -Lo minikube https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64 \
&amp;&amp; chmod +x minikube &amp;&amp; sudo cp minikube /usr/local/bin/ &amp;&amp; rm minikube
</pre></div>
</div>
</li>
<li><p>Mac quick reference:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ curl -Lo minikube https://storage.googleapis.com/minikube/releases/latest/minikube-darwin-amd64 \
&amp;&amp; chmod +x minikube &amp;&amp; sudo mv minikube /usr/local/bin/
</pre></div>
</div>
</li>
</ul>
</li>
</ol>
</div>
<div class="section" id="step-2-start-and-test-minikube">
<h3>Step 2: Start and Test Minikube<a class="headerlink" href="#step-2-start-and-test-minikube" title="Permalink to this headline">¶</a></h3>
<p>This step summarizes the procedure to start Minikube and test basic
functionality. If you have problems, see the Kubernetes document
<a class="reference external" href="https://kubernetes.io/docs/setup/minikube/">Running Kubernetes Locally via Minikube</a>.</p>
<ol class="arabic">
<li><p>Start Minikube.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> minikube start
</pre></div>
</div>
</li>
<li><p>Start Minikube’s “Hello, World” test cluster, <code class="docutils literal notranslate"><span class="pre">hello-minikube</span></code>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> kubectl run hello-minikube --image<span class="o">=</span>k8s.gcr.io/echoserver:1.10 --port<span class="o">=</span><span class="m">8080</span>

<span class="gp">$</span> kubectl expose deployment hello-minikube --type<span class="o">=</span>NodePort
</pre></div>
</div>
</li>
<li><p>Check the list of pods.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> kubectl get pods
</pre></div>
</div>
<p>After the pod is up and running, the output of this command should display a
pod starting with <code class="docutils literal notranslate"><span class="pre">hello-minikube...</span></code>.</p>
</li>
<li><p>Run a <code class="docutils literal notranslate"><span class="pre">curl</span></code> test to the cluster.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ curl $(minikube service hello-minikube --url)
</pre></div>
</div>
</li>
<li><p>Remove the <code class="docutils literal notranslate"><span class="pre">hello-minikube</span></code> cluster.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> kubectl delete services hello-minikube

<span class="gp">$</span> kubectl delete deployment hello-minikube
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="step-3-download-the-sawtooth-configuration-file">
<h3>Step 3: Download the Sawtooth Configuration File<a class="headerlink" href="#step-3-download-the-sawtooth-configuration-file" title="Permalink to this headline">¶</a></h3>
<p>Download the Kubernetes configuration (kubeconfig) file for a Sawtooth network,
<a class="reference external" href="./sawtooth-kubernetes-default-poet.yaml">sawtooth-kubernetes-default-poet.yaml</a>.</p>
<p>This kubeconfig file creates a Sawtooth network with five pods, each running a
Sawtooth validator node. The pods are numbered from 0 to 4.</p>
<p>The configuration file also specifies the container images to download (from
DockerHub) and the network settings needed for the containers to communicate
correctly.</p>
</div>
<div class="section" id="step-4-start-the-sawtooth-cluster">
<h3>Step 4: Start the Sawtooth Cluster<a class="headerlink" href="#step-4-start-the-sawtooth-cluster" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The Kubernetes configuration file handles the Sawtooth startup steps such as
generating keys and creating a genesis block. To learn about the full
Sawtooth startup process, see <a class="reference internal" href="ubuntu.html"><span class="doc">Using Ubuntu for Your Development Environment</span></a>.</p>
</div>
<p>Use these steps to start the Sawtooth network:</p>
<ol class="arabic">
<li><p>Change your working directory to the same directory where you saved the
configuration file.</p></li>
<li><p>Make sure that Minikube is running.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> minikube status
<span class="go">minikube: Running</span>
<span class="go">cluster: Running</span>
<span class="go">kubectl: Correctly Configured: pointing to minikube-vm at 192.168.99.100</span>
</pre></div>
</div>
<p>If necessary, start it with <code class="docutils literal notranslate"><span class="pre">minikube</span> <span class="pre">start</span></code>.</p>
</li>
<li><p>Start Sawtooth in a local Kubernetes cluster.</p>
<div class="highlight-console notranslate" id="restart-kube-label"><div class="highlight"><pre><span></span><span class="gp">$</span> kubectl apply -f sawtooth-kubernetes-default-poet.yaml
<span class="go">deployment.extensions/sawtooth-0 created</span>
<span class="go">service/sawtooth-0 created</span>
<span class="go">deployment.extensions/sawtooth-1 created</span>
<span class="go">service/sawtooth-1 created</span>
<span class="go">deployment.extensions/sawtooth-2 created</span>
<span class="go">service/sawtooth-2 created</span>
<span class="go">deployment.extensions/sawtooth-3 created</span>
<span class="go">service/sawtooth-3 created</span>
<span class="go">deployment.extensions/sawtooth-4 created</span>
<span class="go">service/sawtooth-4 created</span>
</pre></div>
</div>
</li>
<li><p>(Optional) Start the Minikube dashboard.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> minikube dashboard
</pre></div>
</div>
<p>This command opens the dashboard in your default browser. The overview page
shows the Sawtooth deployment, pods, and replica sets.</p>
</li>
</ol>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Any work done in this environment will be lost once you stop Minikube and
delete the Sawtooth cluster. In order to use this environment for application
development, or to start and stop Sawtooth nodes (and pods), you would need
to take additional steps, such as defining volume storage. See the
<a class="reference external" href="https://kubernetes.io/docs/home/">Kubernetes documentation</a> for more
information.</p>
</div>
</div>
<div class="section" id="step-5-confirm-network-and-blockchain-functionality">
<span id="confirm-func-kube-label"></span><h3>Step 5: Confirm Network and Blockchain Functionality<a class="headerlink" href="#step-5-confirm-network-and-blockchain-functionality" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p>Connect to the shell container on the first pod.</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ kubectl exec -it $(kubectl get pods | awk &#39;/sawtooth-0/{print $1}&#39;) --container sawtooth-shell -- bash

root@sawtooth-0#
</pre></div>
</div>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In this procedure, the prompt <code class="docutils literal notranslate"><span class="pre">root&#64;sawtooth-0#</span></code> marks the commands that should
be run on the Sawtooth node in pod 0. (The actual prompt is similar to
<code class="docutils literal notranslate"><span class="pre">root&#64;sawtooth-0-5ff6d9d578-5w45k:/#</span></code>.)</p>
</div>
</li>
<li><p>Display the list of blocks on the Sawtooth blockchain.</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>root@sawtooth-0# sawtooth block list
</pre></div>
</div>
</div></blockquote>
<p>The output will be similar to this example:</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">NUM  BLOCK_ID                                                                                                                          BATS  TXNS  SIGNER</span>
<span class="go">2    f40b90d06b4a9074af2ab09e0187223da7466be75ec0f472f2edd5f22960d76e402e6c07c90b7816374891d698310dd25d9b88dce7dbcba8219d9f7c9cae1861  3     3     02e56e...</span>
<span class="go">1    4d7b3a2e6411e5462d94208a5bb83b6c7652fa6f4c2ada1aa98cabb0be34af9d28cf3da0f8ccf414aac2230179becade7cdabbd0976c4846990f29e1f96000d6  1     1     034aad...</span>
<span class="go">0    0fb3ebf6fdc5eef8af600eccc8d1aeb3d2488992e17c124b03083f3202e3e6b9182e78fef696f5a368844da2a81845df7c3ba4ad940cee5ca328e38a0f0e7aa0  3     11    034aad...</span>
</pre></div>
</div>
</div></blockquote>
<p>Block 0 is the <a class="reference internal" href="../glossary.html#term-genesis-block"><span class="xref std std-term">genesis block</span></a>. The other two blocks contain
transactions for on-chain settings, such as setting PoET consensus.</p>
</li>
<li><p>In a separate terminal window, connect to a different pod (such as pod 1) and
verify that it has joined the Sawtooth network.</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ kubectl exec -it $(kubectl get pods | awk &#39;/sawtooth-1/{print $1}&#39;) --container sawtooth-shell -- bash

root@sawtooth-1#
</pre></div>
</div>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The prompt <code class="docutils literal notranslate"><span class="pre">root&#64;sawtooth-1#</span></code> marks the commands that should be run on
the Sawtooth node in pod 1.</p>
</div>
</li>
<li><p>Display the list of blocks on the second pod.</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>root@sawtooth-1# sawtooth block list
</pre></div>
</div>
</div></blockquote>
<p>You should see the same list of blocks with the same block IDs, as in this
example:</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">NUM  BLOCK_ID                                                                                                                          BATS  TXNS  SIGNER</span>
<span class="go">2    f40b90d06b4a9074af2ab09e0187223da7466be75ec0f472f2edd5f22960d76e402e6c07c90b7816374891d698310dd25d9b88dce7dbcba8219d9f7c9cae1861  3     3     02e56e...</span>
<span class="go">1    4d7b3a2e6411e5462d94208a5bb83b6c7652fa6f4c2ada1aa98cabb0be34af9d28cf3da0f8ccf414aac2230179becade7cdabbd0976c4846990f29e1f96000d6  1     1     034aad...</span>
<span class="go">0    0fb3ebf6fdc5eef8af600eccc8d1aeb3d2488992e17c124b03083f3202e3e6b9182e78fef696f5a368844da2a81845df7c3ba4ad940cee5ca328e38a0f0e7aa0  3     11    034aad...</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>(Optional) You can repeat the previous two steps on the other pods to verify
that they have the same block list. To connect to a different pod, replace
the <cite>N</cite> (in <code class="docutils literal notranslate"><span class="pre">sawtooth-N</span></code>) in the following command with the pod number.
command:</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ kubectl exec -it $(kubectl get pods | awk &#39;/sawtooth-N/{print $1}&#39;) --container sawtooth-shell -- bash
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>(Optional) You can also connect to the shell container of any pod, and
run the following Sawtooth commands to show the other nodes on the network.</p>
<ol class="loweralpha simple">
<li><p>Run <code class="docutils literal notranslate"><span class="pre">sawtooth</span> <span class="pre">peer</span> <span class="pre">list</span></code> to show the peers of a particular node.</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">sawnet</span> <span class="pre">peers</span> <span class="pre">list</span></code> to display a complete graph of peers on the
network (available in Sawtooth release 1.1 and later).</p></li>
</ol>
</li>
<li><p>You can submit a transaction on one Sawtooth node, then look for the results
of that transaction on another node.</p>
<ol class="loweralpha">
<li><p>From the shell container on pod 0, use the <code class="docutils literal notranslate"><span class="pre">intkey</span> <span class="pre">set</span></code> command to
submit a transaction on the first validator node. This example sets a key
named <code class="docutils literal notranslate"><span class="pre">MyKey</span></code> to the value 999.</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">root@sawtooth-0#</span> intkey <span class="nb">set</span> MyKey <span class="m">999</span>
<span class="go">{</span>
<span class="go">  &quot;link&quot;:</span>
<span class="go">  &quot;http://127.0.0.1:8008/batch_statuses?id=1b7f121a82e73ba0e7f73de3e8b46137a2e47b9a2d2e6566275b5ee45e00ee5a06395e11c8aef76ff0230cbac0c0f162bb7be626df38681b5b1064f9c18c76e5&quot;</span>
<span class="go">  }</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>From the shell container on a different pod (such as pod 1), check that
the value has been changed on that validator node.</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">root@sawtooth-1#</span> intkey show MyKey
<span class="go">MyKey: 999</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
</li>
<li><p>You can check whether a Sawtooth component is running by connecting to a
different container, then running the <code class="docutils literal notranslate"><span class="pre">ps</span></code> command. The container names are
available in the kubeconfig file or on a pod’s page on the Kubernetes
dashboard.</p>
<p>The following example connects to pod 3’s PoET Validator Registry container
(<code class="docutils literal notranslate"><span class="pre">sawtooth-poet-validator-registry-tp</span></code>), then displays the list of running
process.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> kubectl <span class="nb">exec</span> -it <span class="k">$(</span>kubectl get pods <span class="p">|</span> awk <span class="s1">&#39;/sawtooth-3/{print $1}&#39;</span><span class="k">)</span> --container sawtooth-poet-validator-registry-tp -- bash

<span class="gp">root@sawtooth-3#</span> ps --pid <span class="m">1</span> fw
<span class="go">  PID TTY      STAT   TIME COMMAND</span>
<span class="go">    1 ?        Ssl    0:02 /usr/bin/python3 /usr/bin/poet-validator-registry-tp -vv -C tcp://sawtooth-3-5bd565ff45-2klm7:4004</span>
</pre></div>
</div>
</li>
</ol>
<p>At this point, your environment is ready for experimenting with Sawtooth.</p>
<p>For more ways to test basic functionality, see the Kubernetes section of
“Setting Up a Sawtooth Application Development Environment”.</p>
<ul class="simple">
<li><p>To use Sawtooth client commands to view block information and check state
data, see <a class="reference internal" href="kubernetes.html#sawtooth-client-kube-label"><span class="std std-ref">Step 6: Use Sawtooth Commands as a Client</span></a>.</p></li>
<li><p>For information on the Sawtooth logs, see <a class="reference internal" href="kubernetes.html#examine-logs-kube-label"><span class="std std-ref">Step 8: Examine Sawtooth Logs</span></a>.</p></li>
</ul>
</div>
<div class="section" id="step-6-configure-the-allowed-transaction-types-optional">
<span id="configure-txn-procs-kube-label"></span><h3>Step 6. Configure the Allowed Transaction Types (Optional)<a class="headerlink" href="#step-6-configure-the-allowed-transaction-types-optional" title="Permalink to this headline">¶</a></h3>
<p>By default, a validator accepts transactions from any transaction processor.
However, Sawtooth allows you to limit the types of transactions that can be
submitted.</p>
<p>In this step, you will configure the validator network to accept transactions
only from the four transaction processors in the example environment:
IntegerKey, Settings, XO, and Validator Registry. Transaction-type restrictions
are an on-chain setting, so this configuration change is applied to all
validators.</p>
<p>The <a class="reference internal" href="../transaction_family_specifications/settings_transaction_family.html"><span class="doc">Settings transaction processor</span></a>
handles on-chain configuration settings. You can use the <code class="docutils literal notranslate"><span class="pre">sawset</span></code> command to
create and submit a batch of transactions containing the configuration change.</p>
<p>Use the following steps to create and submit a batch containing the new setting.</p>
<ol class="arabic">
<li><p>Connect to the validator container of the first node
(<code class="docutils literal notranslate"><span class="pre">sawtooth-0-{xxxxxxxx}</span></code>). The next command requires the validator key that
was generated in that container.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> kubectl <span class="nb">exec</span> -it <span class="k">$(</span>kubectl get pods <span class="p">|</span> awk <span class="s1">&#39;/sawtooth-0/{print $1}&#39;</span><span class="k">)</span> --container sawtooth-validator -- bash
<span class="gp">root@sawtooth-0#</span>
</pre></div>
</div>
</li>
<li><p>Run the following command from the validator container:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">root@sawtooth-0#</span> sawset proposal create --key /etc/sawtooth/keys/validator.priv sawtooth.validator.transaction_families<span class="o">=</span><span class="s1">&#39;[{&quot;family&quot;: &quot;intkey&quot;, &quot;version&quot;: &quot;1.0&quot;}, {&quot;family&quot;:&quot;sawtooth_settings&quot;, &quot;version&quot;:&quot;1.0&quot;}, {&quot;family&quot;:&quot;xo&quot;, &quot;version&quot;:&quot;1.0&quot;}, {&quot;family&quot;:&quot;sawtooth_validator_registry&quot;, &quot;version&quot;:&quot;1.0&quot;}]&#39;</span>
</pre></div>
</div>
<p>This command sets <code class="docutils literal notranslate"><span class="pre">sawtooth.validator.transaction_families</span></code> to a JSON array
that specifies the family name and version of each allowed transaction
processor (defined in the transaction header of each family’s
<a class="reference internal" href="../transaction_family_specifications.html"><span class="doc">transaction family specification</span></a>).</p>
</li>
<li><p>After this command runs, a <code class="docutils literal notranslate"><span class="pre">TP_PROCESS_REQUEST</span></code> message appears in the log
for the Settings transaction processor.</p>
<ul>
<li><p>You can use the Kubernetes dashboard to view this log message:</p>
<ol class="loweralpha">
<li><p>From the Overview page, scroll to the list of pods and click on any pod
name.</p></li>
<li><p>On the pod page, click <span class="guilabel">LOGS</span> (in the top right).</p></li>
<li><p>On the pod’s log page, select logs from <code class="docutils literal notranslate"><span class="pre">sawtooth-settings-tp</span></code>, then
scroll to the bottom of the log. The message will resemble this example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[2018-09-05 20:07:41.903 DEBUG    core] received message of type: TP_PROCESS_REQUEST
</pre></div>
</div>
</li>
</ol>
</li>
<li><p>You can also connect to the <code class="docutils literal notranslate"><span class="pre">sawtooth-settings-tp</span></code> container on any pod,
then examine <code class="docutils literal notranslate"><span class="pre">/var/log/sawtooth/logs/settings-{xxxxxxx}-debug.log</span></code>. (Each
Settings log file has a unique string in the name.) The messages will
resemble this example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span> .
 .
 .
[20:07:58.039 [MainThread] core DEBUG] received message of type: TP_PROCESS_REQUEST
[20:07:58.190 [MainThread] handler INFO] Setting setting sawtooth.validator.transaction_families changed from None to [{&quot;family&quot;: &quot;intkey&quot;, &quot;version&quot;: &quot;1.0&quot;}, {&quot;family&quot;:&quot;sawtooth_settings&quot;, &quot;version&quot;:&quot;1.0&quot;}, {&quot;family&quot;:&quot;xo&quot;, &quot;version&quot;:&quot;1.0&quot;}, {&quot;family&quot;:&quot;sawtooth_validator_registry&quot;, &quot;version&quot;:&quot;1.0&quot;}]
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>Run the following command to check the setting change. You can use any
container, such as a shell or another validator container.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">root@sawtooth-1#</span> sawtooth settings list
</pre></div>
</div>
<p>The output should be similar to this example:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sawtooth.consensus.algorithm.name: PoET</span>
<span class="go">sawtooth.consensus.algorithm.version: 0.1</span>
<span class="go">sawtooth.poet.initial_wait_time: 15</span>
<span class="go">sawtooth.poet.key_block_claim_limit: 100000</span>
<span class="go">sawtooth.poet.report_public_key_pem: -----BEGIN PUBL...</span>
<span class="go">sawtooth.poet.target_wait_time: 15</span>
<span class="go">sawtooth.poet.valid_enclave_basenames: b785c58b77152cb...</span>
<span class="go">sawtooth.poet.valid_enclave_measurements: c99f21955e38dbb...</span>
<span class="go">sawtooth.poet.ztest_minimum_win_count: 100000</span>
<span class="go">sawtooth.publisher.max_batches_per_block: 200</span>
<span class="go">sawtooth.settings.vote.authorized_keys: 03e27504580fa15...</span>
<span class="go">sawtooth.validator.transaction_families: [{&quot;family&quot;: &quot;in...</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="step-6-stop-the-sawtooth-kubernetes-cluster">
<span id="stop-sawtooth-kube2-label"></span><h3>Step 6: Stop the Sawtooth Kubernetes Cluster<a class="headerlink" href="#step-6-stop-the-sawtooth-kubernetes-cluster" title="Permalink to this headline">¶</a></h3>
<p>Use the following commands to stop and reset the Sawtooth network.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Any work done in this environment will be lost once you delete the Sawtooth
pods. To keep your work, you would need to take additional steps, such as
defining volume storage.  See the
<a class="reference external" href="https://kubernetes.io/docs/home/">Kubernetes documentation</a> for more
information.</p>
</div>
<ol class="arabic">
<li><p>Log out of all Sawtooth containers.</p></li>
<li><p>Stop Sawtooth and delete the pods. Run the following command from the same
directory where you saved the configuration file.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> kubectl delete -f sawtooth-kubernetes-default-poet.yaml
<span class="go">deployment.extensions &quot;sawtooth-0&quot; deleted</span>
<span class="go">service &quot;sawtooth-0&quot; deleted</span>
<span class="go">deployment.extensions &quot;sawtooth-1&quot; deleted</span>
<span class="go">service &quot;sawtooth-1&quot; deleted</span>
<span class="go">deployment.extensions &quot;sawtooth-2&quot; deleted</span>
<span class="go">service &quot;sawtooth-2&quot; deleted</span>
<span class="go">deployment.extensions &quot;sawtooth-3&quot; deleted</span>
<span class="go">service &quot;sawtooth-3&quot; deleted</span>
<span class="go">deployment.extensions &quot;sawtooth-4&quot; deleted</span>
<span class="go">service &quot;sawtooth-4&quot; deleted</span>
</pre></div>
</div>
</li>
<li><p>Stop the Minikube cluster.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> minikube stop
<span class="go">Stopping local Kubernetes cluster...</span>
<span class="go">Machine stopped.</span>
</pre></div>
</div>
</li>
<li><p>Delete the Minikube cluster, VM, and all associated files.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> minikube delete
<span class="go">Deleting local Kubernetes cluster...</span>
<span class="go">Machine deleted.</span>
</pre></div>
</div>
</li>
</ol>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="intro_xo_transaction_family.html" class="btn btn-neutral float-right" title="Playing with the XO Transaction Family" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="kubernetes.html" class="btn btn-neutral float-left" title="Using Kubernetes for Your Development Environment" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015-2017, Intel Corporation

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>