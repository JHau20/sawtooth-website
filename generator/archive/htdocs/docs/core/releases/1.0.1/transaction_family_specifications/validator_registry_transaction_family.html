

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Validator Registry Transaction Family Specification &mdash; Sawtooth v1.0.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Sawtooth v1.0.1 documentation" href="../index.html"/>
        <link rel="up" title="Transaction Family Specifications" href="../transaction_family_specifications.html"/>
        <link rel="next" title="Smallbank Transaction Family Specification" href="smallbank_transaction_family.html"/>
        <link rel="prev" title="XO Transaction Family Specification" href="xo_transaction_family.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../contents.html" class="icon icon-home"> Sawtooth
          

          
          </a>

          
            
            
              <div class="version">
                v1.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../app_developers_guide.html">Application Developer&#8217;s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sysadmin_guide.html">System Administrator&#8217;s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rest_api.html">REST API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sdks.html">Sawtooth SDK APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli.html">CLI Reference</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../transaction_family_specifications.html">Transaction Family Specifications</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="settings_transaction_family.html">Settings Transaction Family Specification</a></li>
<li class="toctree-l2"><a class="reference internal" href="identity_transaction_family.html">Identity Transaction Family Specification</a></li>
<li class="toctree-l2"><a class="reference internal" href="blockinfo_transaction_family.html">BlockInfo Transaction Family Specification</a></li>
<li class="toctree-l2"><a class="reference internal" href="integerkey_transaction_family.html">IntegerKey Transaction Family Specification</a></li>
<li class="toctree-l2"><a class="reference internal" href="xo_transaction_family.html">XO Transaction Family Specification</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Validator Registry Transaction Family Specification</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#state">State</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#addressing">Addressing</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#transaction-payload">Transaction Payload</a></li>
<li class="toctree-l3"><a class="reference internal" href="#transaction-header">Transaction Header</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#inputs-and-outputs">Inputs and Outputs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dependencies">Dependencies</a></li>
<li class="toctree-l4"><a class="reference internal" href="#family">Family</a></li>
<li class="toctree-l4"><a class="reference internal" href="#encoding">Encoding</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#execution">Execution</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="smallbank_transaction_family.html">Smallbank Transaction Family Specification</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../community.html">Community</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../contents.html">Sawtooth</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../contents.html">Docs</a> &raquo;</li>
        
          <li><a href="../transaction_family_specifications.html">Transaction Family Specifications</a> &raquo;</li>
        
      <li>Validator Registry Transaction Family Specification</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/transaction_family_specifications/validator_registry_transaction_family.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="validator-registry-transaction-family-specification">
<h1>Validator Registry Transaction Family Specification<a class="headerlink" href="#validator-registry-transaction-family-specification" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>The validator registry transaction family provides a way to add new validators
to the network.</p>
<p>The validator&#8217;s information is used by poet_consensus to verify that when a
validator tries to claim a block it is following the block claiming policies of
PoET consensus. For example, the Z policy will refuse blocks from a validator
if it has already claimed a disproportionate amount of blocks compared to the
other validators on the network. The C policy says that a validator may not
claim blocks, after being added to the registry or updating their information,
until a certain number of blocks are claimed by other participants. The number
of blocks claimed since signup can be found by checking the current block number
against the block number that is stored in the validator information when the
validator registry information has either been added or updated. And finally the K
policy requires new signup information to be sent to the validator registry
after it has claimed a maximum number of block. If the validator is not found
in the validator registry the block will be rejected since there is no way to
validate.</p>
<p>Currently the number of blocks claimed by a specific validator is stored within
the poet_consensus, not within the validator registry.</p>
</div>
<div class="section" id="state">
<h2>State<a class="headerlink" href="#state" title="Permalink to this headline">¶</a></h2>
<p>This section describes in detail how validator information, including
identification and signup data, is stored and addressed using the validator
registry transaction family.</p>
<p>The following protocol buffers definition defines the validator info:</p>
<div class="highlight-protobuf"><div class="highlight"><pre><span></span><span class="kd">message</span> <span class="nc">ValidatorInfo</span> <span class="p">{</span>
  <span class="c1">// The name of the endpoint. It should be a human readable name.</span>
  <span class="kt">string</span> <span class="na">name</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

  <span class="c1">// The validator&#39;s public key (currently using signer_public_key as this is</span>
  <span class="c1">// stored in the transaction header)</span>
  <span class="kt">string</span> <span class="na">id</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

  <span class="c1">// This is the protocol buffer described below.</span>
  <span class="n">SignUpInfo</span> <span class="na">signup_info</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

  <span class="c1">// The header signature for the ValidatorRegistryPayload transaction. This</span>
  <span class="c1">// will be used to look up the block the ValidatorInfo was committed on.</span>
  <span class="kt">string</span> <span class="na">transaction_id</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The above ValidatorInfo includes the following protocol buffer:</p>
<div class="highlight-protobuf"><div class="highlight"><pre><span></span><span class="kd">message</span> <span class="nc">SignUpInfo</span> <span class="p">{</span>
  <span class="c1">// Encoded public key corresponding to private key used by PoET to sign</span>
  <span class="c1">// wait certificates.</span>
  <span class="kt">string</span> <span class="na">poet_public_key</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

  <span class="c1">// Information that can be used internally to verify the validity of</span>
  <span class="c1">// the signup information stored as an opaque buffer.</span>
  <span class="kt">string</span> <span class="na">proof_data</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

  <span class="c1">// A string corresponding to the anti-Sybil ID for the enclave that</span>
  <span class="c1">// generated the signup information.</span>
  <span class="kt">string</span> <span class="na">anti_sybil_id</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

  <span class="c1">// The nonce associated with the signup info.  Note that this must match</span>
  <span class="c1">// the nonce provided when the signup info was created.</span>
  <span class="kt">string</span> <span class="na">nonce</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Currently the poet_enclave needs a way to check how many validators are
currently registered within the validator registry. It also needs a way to
find the validator_id associated with an anti-sybil_id. A ValidatorMap, where
the anti_sybil_id is the key and the validator_id is the value solves both of
these problems.</p>
<div class="highlight-protobuf"><div class="highlight"><pre><span></span><span class="kd">message</span> <span class="nc">ValidatorMap</span> <span class="p">{</span>
    <span class="c1">// Contains a validator entry where the key is an  anti_sybil_id,</span>
    <span class="c1">// and the value is a validator_id</span>
    <span class="kd">message</span> <span class="nc">Entry</span> <span class="p">{</span>
        <span class="kt">string</span> <span class="na">key</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="kt">string</span> <span class="na">value</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// List of validator entries</span>
    <span class="k">repeated</span> <span class="n">Entry</span> <span class="na">entries</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This can be used to check the number of validators registered. This
information is used to decide what number of blocks a validator has to wait
for before it can start claiming blocks after it adds new signup information
to the validator registry. This check is necessary because if the number of
blocks that must be waited on is greater than the number of validators minus
one, it is possible for the network to get into a state where nobody can
publish blocks because the validators are all waiting for more blocks to be
committed or their signup information to be added to a block.</p>
<p>Validator registry transaction would not be able to be done at the same time as
any other transaction as an update to the ValidatorMap is necessary. However all
other transaction that need to access the state set by the validator registry,
can be done in parallel since it will only be a read and  the statics for each
validator is stored in the poet_enclave. If this was changed so that the stats
were stored in the validator registry this would require a write to state every
time a block is published and would reduce the ability for parallelism.</p>
<div class="section" id="addressing">
<h3>Addressing<a class="headerlink" href="#addressing" title="Permalink to this headline">¶</a></h3>
<p>When a validator’s signup info is registered or updated it should be accessed
using the following algorithm:</p>
<p>Addresses for the validator registry transaction family are set by adding
sha256 hash of the validator&#8217;s id to the validator registry namespace. The
namespace for the validator registry will be the first 6 characters of the
sha256  hash of the string “validator_registry”, which is “6a4372” For example,
the validator signup info of a validator with the id “validator_id” could be
set like this:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="go">&gt;&gt;&gt;“6a4372” + hashlib.sha256(&#39;validator_id&#39;.encode(&quot;utf-8&quot;)).hexdigest()</span>
<span class="go">&#39;6a43722aee5b550a3cbd1595f4de10049ee805bc035b5e232dfacfc31cc6275170b30d&#39;</span>
</pre></div>
</div>
<dl class="docutils">
<dt>The map of the current registered validator_id should be stored at the</dt>
<dd>following address:</dd>
</dl>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="go">&gt;&gt;&gt;“6a4372” + hashlib.sha256(&#39;validator_map&#39;.encode()).hexdigest()</span>
<span class="go">&#39;6a437247a1c12c0fb03aa6e242e6ce988d1cdc7fcc8c2a62ab3ab1202325d7d677e84c&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="transaction-payload">
<h2>Transaction Payload<a class="headerlink" href="#transaction-payload" title="Permalink to this headline">¶</a></h2>
<p>Validator registry transaction family payloads are defined by the following
protocol buffers code:</p>
<div class="highlight-protobuf"><div class="highlight"><pre><span></span><span class="kd">message</span> <span class="nc">ValidatorRegistryPayload</span> <span class="p">{</span>
  <span class="c1">// The action that the transaction processor will take. Currently this</span>
  <span class="c1">// is only “register”, but could include other actions in the futures</span>
  <span class="c1">// such as “revoke”</span>
  <span class="kt">string</span> <span class="na">verb</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

  <span class="c1">// The name of the endpoint. It should be a human readable name.</span>
  <span class="kt">string</span> <span class="na">name</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

  <span class="c1">// Validator&#39;s public key (currently using signer_public_key as this is</span>
  <span class="c1">// stored in the transaction header)</span>
  <span class="kt">string</span> <span class="na">id</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

  <span class="c1">// This is the protocol buffer described above.</span>
  <span class="n">SignUpInfo</span> <span class="na">signup_info</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="transaction-header">
<h2>Transaction Header<a class="headerlink" href="#transaction-header" title="Permalink to this headline">¶</a></h2>
<div class="section" id="inputs-and-outputs">
<h3>Inputs and Outputs<a class="headerlink" href="#inputs-and-outputs" title="Permalink to this headline">¶</a></h3>
<p>The inputs for validator registry family transactions must include:</p>
<ul class="simple">
<li>the address of <em>validator_id</em></li>
<li>the address of <em>validator_map</em></li>
<li>the address of <em>sawtooth.poet.report_public_key_pem</em></li>
<li>the address of <em>sawtooth.poet.valid_enclave_measurement</em></li>
<li>the address of <em>sawtooth.poet.valid_enclave_basenames</em></li>
</ul>
<p>The outputs for validator registry family transactions must include:</p>
<ul class="simple">
<li>the address of <em>validator_id</em></li>
<li>the address of <em>validator_map</em></li>
</ul>
</div>
<div class="section" id="dependencies">
<h3>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h3>
<p>None</p>
</div>
<div class="section" id="family">
<h3>Family<a class="headerlink" href="#family" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>family_name: &#8220;sawtooth_validator_registry&#8221;</li>
<li>family_version: &#8220;1.0&#8221;</li>
</ul>
</div>
<div class="section" id="encoding">
<h3>Encoding<a class="headerlink" href="#encoding" title="Permalink to this headline">¶</a></h3>
<p>The encoding field must be set to &#8220;application/protobuf&#8221;.</p>
</div>
</div>
<div class="section" id="execution">
<h2>Execution<a class="headerlink" href="#execution" title="Permalink to this headline">¶</a></h2>
<p>Untrusted python code that is a part of the transaction processor will verify
the attestation verification report for the signup information. It is important
to note, that the IAS report public key will need to be on the block chain and
it will need to be set on configuration. This will allow both the simulator
logic and real SGX logic to be the same.</p>
<p>If the validator_name does not match syntactic requirements, the transaction is
invalid. The current requirement is that the validator_name is 64 characters
or less.</p>
<p>If the validator_id does not match the transaction signer, the transaction is
invalid. The validator_id should be the same as the signer_public_key stored in the
transaction header.</p>
<p>The signup info needs to be verified next. The signup info, public key hash, and
the most recent wait_certificate_id are passed to verify the signup data.</p>
<p>If any of the signup info checks fail verification, the validator_registry
transaction is rejected and a invalid transaction response is returned.</p>
<p>If the transaction is deemed to be valid, the validator_id is used to find
the address where the validator_info should be stored. Store the serialized
ValidatorInfo protocol buffer in state at the address as mentioned above. If
this validator is new (not updating its SignUpInfo), the validator’s id needs
to be added to the validator_map.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="smallbank_transaction_family.html" class="btn btn-neutral float-right" title="Smallbank Transaction Family Specification" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="xo_transaction_family.html" class="btn btn-neutral" title="XO Transaction Family Specification" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015-2017, Intel Corporation.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'v1.0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>